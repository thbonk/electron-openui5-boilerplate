/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./Bar','./Button','./SuggestionsList','./SuggestionItem'],function(q,B,a,S,b){"use strict";function c(i){var p=i,d,l,e,u=sap.ui.Device.system.phone,s=this;q.sap.require(u?"sap.m.Dialog":"sap.m.Popover");function o(E){var k=E.srcControl;var v;if(k instanceof b){v=k.getSuggestionText();d.close();window.setTimeout(function(){i.setValue(v);i.fireSearch({query:v,suggestionItem:k,refreshButtonPressed:false,clearButtonPressed:false});},0);}}function f(){var k,m,n,r,t;n=new(sap.ui.require('sap/m/SearchField'))({liveChange:function(E){var v=E.getParameter("newValue");i.setValue(v);i.fireLiveChange({newValue:v});i.fireSuggest({suggestValue:v});s.update();},search:function(E){if(!E.getParameter("clearButtonPressed")){k.close();}}});r=new B({contentLeft:n});t=new a({text:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("MSGBOX_CANCEL"),press:function(){k._oCloseTrigger=true;k.close();}});k=new(sap.ui.require('sap/m/Dialog'))({stretch:true,customHeader:r,content:h(),beginButton:t,beforeOpen:function(){m=i.getValue();n.setValue(m);},beforeClose:function(E){if(E.getParameter("origin")){i.setValue(m);}else{i.setValue(n.getValue());}},afterClose:function(E){if(!E.getParameter("origin")){i.fireSearch({query:i.getValue(),refreshButtonPressed:false,clearButtonPressed:false});}}});k.addEventDelegate({ontap:o},i);return k;}function g(){var k=new(sap.ui.require('sap/m/Popover'))({showArrow:false,showHeader:false,horizontalScrolling:false,placement:sap.m.PlacementType.Vertical,offsetX:0,offsetY:0,initialFocus:p,bounce:false,afterOpen:function(){i.$("I").attr("aria-autocomplete","list").attr("aria-haspopup","true");},beforeClose:function(){i.$("I").attr("aria-haspopup","false").removeAttr("aria-activedecendant");},content:h()}).addStyleClass("sapMSltPicker").addStyleClass("sapMSltPicker-CTX");k.open=function(){return this.openBy(p);};function m(){var w=(i.$().outerWidth()/parseFloat(sap.m.BaseFontSize))+"rem";k.getDomRef().style.minWidth=w;}k.addEventDelegate({onAfterRendering:m,ontap:o},i);return k;}function h(){if(!l){l=new S({parentInput:p});}return l;}function j(){if(d===undefined){d=u?f():g();}return d;}this.destroy=function(){if(d){d.close();d.destroy();d=null;}if(l){l.destroy();l=null;}};this.close=function(){if(!u&&this.isOpen()){d.close();}};this.open=function(){if(!this.isOpen()){this.setSelected(-1);j().open();}};this.update=function(){var l=h();window.clearTimeout(e);if(this.isOpen()){e=window.setTimeout(l.update.bind(l),50);}};this.isOpen=function(){return!!d&&d.isOpen();};this.getSelected=function(){return h().getSelectedItemIndex();};this.setSelected=function(k,r){return h().selectByIndex(k,r);};}return c;},true);
