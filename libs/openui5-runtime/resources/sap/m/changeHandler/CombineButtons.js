/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/base/util/uid",'sap/ui/base/ManagedObjectObserver'],function(F,u,M){"use strict";var C={};C.applyChange=function(c,o,p){if(p.modifier.targets!=="jsControlTree"){throw new Error("Combine buttons change can't be applied on XML tree");}var a=c.getDefinition(),m=p.modifier,v=F.getViewForControl(o),s=m.bySelector(a.content.combineButtonSelectors[0],p.appComponent),A=p.appComponent,P=m.getParent(s),i,b,B,I=sap.ui.getCore().getConfiguration().getRTL(),d,e,f=[],r={menuButtonId:"",parentAggregation:"",insertIndex:0};B=a.content.combineButtonSelectors.map(function(g){return m.bySelector(g,A);});b=B[0].sParentAggregationName;r.parentAggregation=b;i=m.findIndexInParentAggregation(s);r.insertIndex=i;d=m.createControl("sap.m.Menu",p.appComponent,v,a.content.menuIdSelector);B.forEach(function(g,h){var j,k,S=a.content.buttonsIdForSave[h],l=m.getProperty(g,"text");k=m.createControl("sap.m.MenuItem",p.appComponent,v,S);m.setProperty(k,"text",g.mProperties.text);m.setProperty(k,"icon",g.mProperties.icon);m.setProperty(k,"enabled",g.mProperties.enabled);k.attachPress(function(E){return g.firePress(E);});new M(function(n){m.setProperty(k,"enabled",n.current);}).observe(g,{properties:["enabled"]});if(l){I?f.unshift(l):f.push(l);}S.id=S.id+"-originalButtonId";j=m.createControl("sap.ui.core.CustomData",p.appComponent,v,S);m.setProperty(j,"key","originalButtonId");m.setProperty(j,"value",m.getId(g));m.removeAggregation(P,b,g);m.insertAggregation(k,"dependents",g);m.insertAggregation(k,"customData",j);m.insertAggregation(d,"items",k,h);});e=m.createControl("sap.m.MenuButton",p.appComponent,v,a.content.menuButtonIdSelector);r.menuButtonId=m.getId(e);m.setProperty(e,"text",f.join("/"));m.insertAggregation(e,"menu",d,0);m.insertAggregation(P,b,e,i);c.setRevertData(r);return true;};C.revertChange=function(c,o,p){var m=p.modifier,r=c.getRevertData(),a=c.getDefinition(),P=r.parentAggregation,A=r.insertIndex,b=m.bySelector(r.menuButtonId,p.appComponent),d=m.getParent(b),B=a.content.combineButtonSelectors;for(var i=0;i<B.length;i++){var e=m.bySelector(B[i],p.appComponent);m.insertAggregation(d,P,e,A+i);}m.removeAggregation(d,P,b);b.destroy();c.resetRevertData();return true;};C.completeChangeContent=function(c,s,p){var m=p.modifier,a=p.appComponent,o=c.getDefinition(),b=s.combineFieldIds;if(b&&b.length>=2){c.addDependentControl(b,"combinedButtons",p);o.content.combineButtonSelectors=b.map(function(d){return m.getSelector(d,a);});o.content.menuButtonIdSelector=m.getSelector(a.createId(u()),a);o.content.menuIdSelector=m.getSelector(a.createId(u()),a);o.content.buttonsIdForSave=b.map(function(){return m.getSelector(a.createId(u()),a);});}else{throw new Error("Combine buttons action cannot be completed: oSpecificChangeInfo.combineFieldIds attribute required");}};return C;},true);
