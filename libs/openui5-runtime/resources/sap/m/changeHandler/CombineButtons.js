/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils"],function(F){"use strict";var C={};C.applyChange=function(c,o,p){if(p.modifier.targets!=="jsControlTree"){throw new Error("Combine buttons change can't be applied on XML tree");}var a=c.getDefinition(),m=p.modifier,v=F.getViewForControl(o),s=m.bySelector(a.content.combineButtonSelectors[0],p.appComponent),A=p.appComponent,P=m.getParent(s),i,b,B,I=sap.ui.getCore().getConfiguration().getRTL(),M,d,e=[];B=a.content.combineButtonSelectors.map(function(f){return m.bySelector(f,A);});b=B[0].sParentAggregationName;i=P.indexOfAggregation(b,s);M=m.createControl("sap.m.Menu",p.appComponent,v);M.attachItemSelected(function(E){E.getParameter("item").firePress();});B.forEach(function(f,g){var h=v.createId(jQuery.sap.uid()),j=m.getProperty(f,"text");var k=m.createControl("sap.m.MenuItem",p.appComponent,v,h);m.setProperty(k,"text",f.mProperties.text);m.setProperty(k,"icon",f.mProperties.icon);k.attachPress(function(E){return f.firePress(E);});if(j){I?e.unshift(j):e.push(j);}var l=m.createControl("sap.ui.core.CustomData",p.appComponent,v,h+"-originalButtonId");m.setProperty(l,"key","originalButtonId");m.setProperty(l,"value",m.getId(f));m.removeAggregation(o,b,f);m.insertAggregation(k,"dependents",f);m.insertAggregation(k,"customData",l);m.insertAggregation(M,"items",k,g);});d=m.createControl("sap.m.MenuButton",p.appComponent,v,v.createId(jQuery.sap.uid()));m.setProperty(d,"text",e.join("/"));m.insertAggregation(d,"menu",M,0);m.insertAggregation(o,b,d,i);};C.completeChangeContent=function(c,s,p){var m=p.modifier,a=p.appComponent,o=c.getDefinition(),b=s.combineFieldIds;if(b&&b.length>=2){c.addDependentControl(b,"combinedButtons",p);o.content.combineButtonSelectors=b.map(function(d){return m.getSelector(d,a);});}else{throw new Error("Combine buttons action cannot be completed: oSpecificChangeInfo.combineFieldIds attribute required");}};return C;},true);
