/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global"],function(q){"use strict";var M={};var _={CHANGE_TYPE:"moveTableColumns",SOURCE_ALIAS:"source",TARGET_ALIAS:"target",MOVED_ELEMENTS_ALIAS:"movedElements"};M.applyChange=function(c,r,p){var m=p.modifier,v=p.view,a=p.appComponent,C="columns",s="cells",i="items",o=c.getContent(),t=c.getDependentControl(_.SOURCE_ALIAS,p),T=c.getDependentControl(_.TARGET_ALIAS,p),b=m.getAggregation(T,C);if(t!==T){q.sap.log.warning("Moving columns between different tables is not yet supported.");return false;}o.movedElements.forEach(function(d){var e=m.bySelector(d.selector,a,v),S,f,g,h,j;if(!e){j=d.selector&&d.selector.id;q.sap.log.warning("The table column with id: '"+j+"' stored in the change is not found and the move operation cannot be applied");return;}g=b.indexOf(e);h=d.sourceIndex;f=d.targetIndex;if(g!==f){S=g;}else{S=h;}m.removeAggregation(T,C,e);m.insertAggregation(T,C,e,f);m.getAggregation(T,i).forEach(function(I){var k=m.getAggregation(I,s),l;if(m.getControlType(I)==="sap.m.GroupHeaderListItem"){return;}if(!k){q.sap.log.warning("Aggregation cells to move not found");return;}if(S<0||S>=k.length){q.sap.log.warning("Move cells in table item called with invalid index: "+S);return;}l=k[S];m.removeAggregation(I,s,l);m.insertAggregation(I,s,l,f);});},this);return true;};M.completeChangeContent=function(c,s,p){var m=p.modifier,a=p.appComponent,C=c.getDefinition(),S=m.bySelector(s.source.id,a),t=m.bySelector(s.target.id,a),A={aggregation:s.source.aggregation,type:m.getControlType(S)},b={aggregation:s.target.aggregation,type:m.getControlType(t)};C.content={movedElements:[]};s.movedElements.forEach(function(e){var E=e.element||m.bySelector(e.id,a);C.content.movedElements.push({selector:m.getSelector(E,a),sourceIndex:e.sourceIndex,targetIndex:e.targetIndex});});C.changeType=_.CHANGE_TYPE;c.addDependentControl(s.source.id,_.SOURCE_ALIAS,p,A);c.addDependentControl(s.target.id,_.TARGET_ALIAS,p,b);c.addDependentControl(s.movedElements.map(function(e){return e.id;}),_.MOVED_ELEMENTS_ALIAS,p);};return M;},true);
