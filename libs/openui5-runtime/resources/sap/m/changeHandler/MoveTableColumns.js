/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global"],function(q){"use strict";var M={};var C="moveTableColumns";var S="source";var T="target";var a="movedElements";var b="columns";var c="cells";var I="items";function _(o,r,p,i){var m=p.modifier,v=p.view,A=p.appComponent,d=o.getContent(),t=o.getDependentControl(S,p),e=o.getDependentControl(T,p),f=m.getAggregation(e,b),s=function(R,h,j){var k=m.getAggregation(R,c);if(!k){q.sap.log.warning("Aggregation cells to move not found");return;}if(h<0||h>=k.length){q.sap.log.warning("Move cells in table item called with invalid index: "+h);return;}var l=k[h];m.removeAggregation(R,c,l);m.insertAggregation(R,c,l,j,v);},g=function(h,j){m.getAggregation(e,I).forEach(function(k){if(m.getControlType(k)==="sap.m.GroupHeaderListItem"){return;}s(k,h,j);});};if(t!==e){q.sap.log.warning("Moving columns between different tables is not yet supported.");return false;}d.movedElements.forEach(function(h){var j=m.bySelector(h.selector,A,v),k,l,n,u,w;if(!j){w=h.selector&&h.selector.id;q.sap.log.warning("The table column with id: '"+w+"' stored in the change is not found and the move operation cannot be applied");return;}n=f.indexOf(j);u=h.sourceIndex;l=q.isFunction(i)&&i(n);l=q.isNumeric(l)?l:h.targetIndex;if(n!==l){k=n;}else{k=u;}m.removeAggregation(e,b,j);m.insertAggregation(e,b,j,l,v);var x=m.getBindingTemplate(e,I);if(x){s(x,k,l);m.updateAggregation(e,I);}else{g(k,l);}},this);return true;}M.applyChange=function(o,r,p){var R=[];_(o,r,p,function(i){R.unshift({index:i});});o.setRevertData(R);};M.revertChange=function(o,r,p){var R=o.getRevertData();_(o,r,p,function(){var i=R.shift();return i&&i.index;});o.resetRevertData();};M.completeChangeContent=function(o,s,p){var m=p.modifier,A=p.appComponent,d=o.getDefinition(),e=m.bySelector(s.source.id,A),t=m.bySelector(s.target.id,A),f={aggregation:s.source.aggregation,type:m.getControlType(e)},g={aggregation:s.target.aggregation,type:m.getControlType(t)};d.content={movedElements:[]};s.movedElements.forEach(function(E){var h=E.element||m.bySelector(E.id,A);d.content.movedElements.push({selector:m.getSelector(h,A),sourceIndex:E.sourceIndex,targetIndex:E.targetIndex});});d.changeType=C;o.addDependentControl(s.source.id,S,p,f);o.addDependentControl(s.target.id,T,p,g);o.addDependentControl(s.movedElements.map(function(h){return h.id;}),a,p);};return M;},true);
