/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/jquery"],function(L,q){"use strict";var M={};var S="source";var T="target";var a="movedElements";var C="columns";var b="cells";var I="items";function _(c,r,p,i){var m=p.modifier,v=p.view,A=p.appComponent,o=c.getContent(),t=c.getDependentControl(S,p),d=c.getDependentControl(T,p),e=m.getAggregation(d,C),s=function(R,g,h){var j=m.getAggregation(R,b);if(!j){L.warning("Aggregation cells to move not found");return;}if(g<0||g>=j.length){L.warning("Move cells in table item called with invalid index: "+g);return;}var k=j[g];m.removeAggregation(R,b,k);m.insertAggregation(R,b,k,h,v);},f=function(g,h){m.getAggregation(d,I).forEach(function(j){if(m.getControlType(j)==="sap.m.GroupHeaderListItem"){return;}s(j,g,h);});};if(t!==d){L.warning("Moving columns between different tables is not yet supported.");return false;}o.movedElements.forEach(function(g){var h=m.bySelector(g.selector,A,v),j,k,l,n,u;if(!h){u=g.selector&&g.selector.id;L.warning("The table column with id: '"+u+"' stored in the change is not found and the move operation cannot be applied");return;}l=e.indexOf(h);n=g.sourceIndex;k=q.isFunction(i)&&i(l);k=q.isNumeric(k)?k:g.targetIndex;if(l!==k){j=l;}else{j=n;}m.removeAggregation(d,C,h);m.insertAggregation(d,C,h,k,v);var w=m.getBindingTemplate(d,I);if(w){s(w,j,k);m.updateAggregation(d,I);}else{f(j,k);}},this);return true;}M.applyChange=function(c,r,p){var R=[];_(c,r,p,function(i){R.unshift({index:i});});c.setRevertData(R);};M.revertChange=function(c,r,p){var R=c.getRevertData();_(c,r,p,function(){var i=R.shift();return i&&i.index;});c.resetRevertData();};M.completeChangeContent=function(c,s,p){var m=p.modifier,A=p.appComponent,d=c.getDefinition(),o=m.bySelector(s.source.id,A),t=m.bySelector(s.target.id,A),e={aggregation:s.source.aggregation,type:m.getControlType(o)},f={aggregation:s.target.aggregation,type:m.getControlType(t)};d.content={movedElements:[]};s.movedElements.forEach(function(E){var g=E.element||m.bySelector(E.id,A);d.content.movedElements.push({selector:m.getSelector(g,A),sourceIndex:E.sourceIndex,targetIndex:E.targetIndex});});c.addDependentControl(s.source.id,S,p,e);c.addDependentControl(s.target.id,T,p,f);c.addDependentControl(s.movedElements.map(function(g){return g.id;}),a,p);};return M;},true);
