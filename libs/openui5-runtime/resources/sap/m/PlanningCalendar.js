/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/base/ManagedObject','sap/ui/base/ManagedObjectObserver','sap/ui/unified/library','sap/ui/unified/calendar/CalendarUtils','sap/ui/unified/calendar/CalendarDate','sap/ui/unified/DateRange','sap/ui/unified/CalendarAppointment','sap/ui/unified/CalendarRow','sap/ui/unified/CalendarRowRenderer','sap/ui/unified/CalendarDateInterval','sap/ui/unified/CalendarWeekInterval','sap/ui/unified/CalendarOneMonthInterval','sap/ui/Device','sap/ui/core/Element','sap/ui/core/Renderer','sap/ui/core/ResizeHandler','sap/ui/core/Item','sap/ui/core/dnd/DragInfo','sap/ui/core/dnd/DropInfo','sap/ui/core/dnd/DragDropInfo','sap/m/Select','sap/m/Button','sap/m/OverflowToolbar','sap/m/Toolbar','sap/m/Table','sap/m/Column','sap/m/ColumnListItem','sap/m/ColumnListItemRenderer','sap/m/StandardListItem','sap/m/StandardListItemRenderer','sap/m/PlanningCalendarRow','sap/m/PlanningCalendarRenderer','sap/m/library',"sap/base/util/deepEqual","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(C,M,a,u,b,c,D,d,e,f,g,h,k,l,E,R,m,I,n,o,p,S,B,O,T,q,r,s,t,v,w,P,x,y,z,L,Q){"use strict";var A=u.CalendarDayType;var F=y.ListMode;var G=y.ToolbarDesign;var H=y.ButtonType;var J=y.PlanningCalendarBuiltInView;var K=y.ScreenSize;var N=u.CalendarAppointmentVisualization;var U=u.GroupAppointmentsMode;var V=u.CalendarIntervalType;var W="DragDropConfig";var X="ResizeConfig";var Y="CreateConfig";var Z="-CLI";var $=C.extend("sap.m.PlanningCalendar",{metadata:{library:"sap.m",properties:{startDate:{type:"object",group:"Data"},viewKey:{type:"string",group:"Appearance",defaultValue:V.Hour},singleSelection:{type:"boolean",group:"Misc",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},showIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showEmptyIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:true},showRowHeaders:{type:"boolean",group:"Appearance",defaultValue:true},noDataText:{type:"string",group:"Misc",defaultValue:null},groupAppointmentsMode:{type:"sap.ui.unified.GroupAppointmentsMode",group:"Appearance",defaultValue:U.Collapsed},appointmentsReducedHeight:{type:"boolean",group:"Appearance",defaultValue:false},appointmentsVisualization:{type:"sap.ui.unified.CalendarAppointmentVisualization",group:"Appearance",defaultValue:N.Standard},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},showDayNamesLine:{type:"boolean",group:"Appearance",defaultValue:false},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:false},builtInViews:{type:"string[]",group:"Appearance",defaultValue:[]},stickyHeader:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{rows:{type:"sap.m.PlanningCalendarRow",multiple:true,singularName:"row"},views:{type:"sap.m.PlanningCalendarView",multiple:true,singularName:"view"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},toolbarContent:{type:"sap.ui.core.Control",multiple:true,singularName:"toolbarContent",forwarding:{getter:"_getTableHeaderToolbar",aggregation:"content"},forwardBinding:true},table:{type:"sap.m.Table",multiple:false,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{appointmentSelect:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},appointments:{type:"sap.ui.unified.CalendarAppointment[]"},multiSelect:{type:"boolean"},domRefId:{type:"string"}}},intervalSelect:{parameters:{startDate:{type:"object"},endDate:{type:"object"},subInterval:{type:"boolean"},row:{type:"sap.m.PlanningCalendarRow"}}},rowSelectionChange:{parameters:{rows:{type:"sap.m.PlanningCalendarRow[]"}}},startDateChange:{},viewChange:{},rowHeaderClick:{row:{type:"sap.m.PlanningCalendarRow"}}},designtime:"sap/m/designtime/PlanningCalendar.designtime"},constructor:function(i,j){C.prototype.constructor.apply(this,arguments);if(typeof i!=="string"){j=i;}if(j&&typeof j.customAppointmentsSorterCallback==="function"){this._fnCustomSortedAppointments=j.customAppointmentsSorterCallback;}}});var _=["_oTimeInterval","_oDateInterval","_oMonthInterval","_oWeekInterval","_oOneMonthInterval"],a1={};a1[V.Day]={sInstanceName:"_oDateInterval",sIdSuffix:"-DateInt",oClass:g};a1[V.Week]={sInstanceName:"_oWeekInterval",sIdSuffix:"-WeekInt",oClass:h};a1[V.OneMonth]={sInstanceName:"_oOneMonthInterval",sIdSuffix:"-OneMonthInt",oClass:k};var b1=K.Desktop;var c1=[J.Hour,J.Day,J.Month,J.Week,J.OneMonth];var d1={PHONE:"600",TABLET:"1024"};var e1=["sap.ui.unified.CalendarTimeInterval","sap.ui.unified.CalendarDateInterval","sap.ui.unified.CalendarMonthInterval"];var f1=C.extend("CalendarHeader",{metadata:{aggregations:{"toolbar":{type:"sap.m.Toolbar",multiple:false},"allCheckBox":{type:"sap.m.CheckBox",multiple:false}}},renderer:function(i,j){i.write("<div");i.writeControlData(j);i.addClass("sapMPlanCalHead");i.writeClasses();i.write(">");var G1=j.getToolbar();if(G1){i.renderControl(G1);}var H1=j.getAllCheckBox();if(H1){i.renderControl(H1);}i.write("</div>");}});$.prototype.init=function(){this._iBreakPointTablet=l.media._predefinedRangeSets[l.media.RANGESETS.SAP_STANDARD_EXTENDED].points[0];this._iBreakPointDesktop=l.media._predefinedRangeSets[l.media.RANGESETS.SAP_STANDARD_EXTENDED].points[1];this._iBreakPointLargeDesktop=l.media._predefinedRangeSets[l.media.RANGESETS.SAP_STANDARD_EXTENDED].points[2];if(l.system.phone||Q('html').hasClass("sapUiMedia-Std-Phone")){this._iSize=0;this._iSizeScreen=0;}else if(l.system.tablet||Q('html').hasClass("sapUiMedia-Std-Tablet")){this._iSize=1;this._iSizeScreen=1;}else{this._iSize=2;this._iSizeScreen=2;}this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.m");var i=this.getId();this._oIntervalTypeSelect=new S(i+"-IntType",{maxWidth:"15rem",ariaLabelledBy:i+"-SelDescr"});this._oIntervalTypeSelect.attachEvent("change",g1,this);this._oTodayButton=new B(i+"-Today",{text:this._oRB.getText("PLANNINGCALENDAR_TODAY"),type:H.Transparent});this._oTodayButton.attachEvent("press",this._handleTodayPress,this);this._oHeaderToolbar=new T(i+"-HeaderToolbar",{design:G.Transparent,content:[this._oIntervalTypeSelect,this._oTodayButton]});this._oCalendarHeader=new f1(i+"-CalHead",{toolbar:this._oHeaderToolbar});this._oInfoToolbar=new T(i+"-InfoToolbar",{height:"auto",design:G.Transparent,content:[this._oCalendarHeader,this._oTimeInterval]});var j=new O(this.getId()+"-Toolbar",{design:G.Transparent});j._oPlanningCalendar=this;var G1=new q(i+"-Table",{sticky:[],infoToolbar:this._oInfoToolbar,headerToolbar:j,mode:F.SingleSelectMaster,columns:[new r({styleClass:"sapMPlanCalRowHead"}),new r({width:"80%",styleClass:"sapMPlanCalAppRow",minScreenWidth:b1,demandPopin:true})],ariaLabelledBy:i+"-Descr"});G1.attachEvent("selectionChange",w1,this);G1.addDelegate({onBeforeRendering:function(){if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off();}},onAfterRendering:function(){this._rowHeaderClickEvent=G1.$().find(".sapMPlanCalRowHead > div.sapMLIB").click(function(H1){var I1=Q(H1.currentTarget).control(0),J1=s1(I1.getParent());this.fireRowHeaderClick({row:J1});}.bind(this));}},false,this);this.setAggregation("table",G1,true);this.setStartDate(new Date());this._resizeProxy=Q.proxy(k1,this);this._fnCustomSortedAppointments=undefined;this.iWidth=0;};$.prototype.exit=function(){if(this._sResizeListener){m.deregister(this._sResizeListener);this._sResizeListener=undefined;}l.orientation.detachHandler(this._updateStickyHeader,this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}var i=this.getAggregation("table");i.removeAllItems();_.forEach(function(G1){if(this[G1]){this[G1]._oPlanningCalendar=undefined;this[G1].destroy();this[G1]=undefined;}},this);if(this._oViews){for(var j in this._oViews){this._oViews[j].destroy();}}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.destroy();}if(this._rowHeaderClickEvent){this._rowHeaderClickEvent.off();this._rowHeaderClickEvent=null;}};$.prototype.onBeforeRendering=function(){this._bBeforeRendering=true;if((!this._oTimeInterval&&!this._oDateInterval&&!this._oMonthInterval&&!this._oWeekInterval&&!this._oOneMonthInterval)||this._bCheckView){this.setViewKey(this.getViewKey());this._bCheckView=undefined;}z1.call(this);if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}this._updateTodayButtonState();l.orientation.detachHandler(this._updateStickyHeader,this);this._bBeforeRendering=undefined;};$.prototype.attachEvent=function(i,j,G1,H1){C.prototype.attachEvent.call(this,i,j,G1,H1);if(this.hasListeners("intervalSelect")){_.forEach(function(I1){if(this[I1]){this[I1]._setAriaRole("button");}},this);}return this;};$.prototype.detachEvent=function(i,j,G1){C.prototype.detachEvent.call(this,i,j,G1);if(!this.hasListeners("intervalSelect")){_.forEach(function(H1){if(this[H1]){this[H1]._setAriaRole("gridcell");}},this);}return this;};$.prototype._setAriaRole=function(i){if(this.hasListeners("intervalSelect")){i._setAriaRole("button");}else{i._setAriaRole("gridcell");}};$.prototype._updateTodayButtonState=function(){if(this._oTodayButton){this._oTodayButton.setEnabled(!this._dateMatchesVisibleRange(new Date(),this.getViewKey()));}};$.prototype._dateMatchesVisibleRange=function(i,j){var G1=this._getView(j,!this._bBeforeRendering);if(!G1){return false;}var H1=G1.getIntervalType(),I1=a1[H1],J1=I1?this[I1.sInstanceName]:null,K1=false;if(J1&&J1._dateMatchesVisibleRange){K1=J1._dateMatchesVisibleRange(i);}return K1;};$.prototype.onAfterRendering=function(i){i.size={width:this.getDomRef().offsetWidth};k1.call(this,i,true);if(!this._sResizeListener){this._sResizeListener=m.register(this,this._resizeProxy);}if(l.system.phone&&this.getStickyHeader()){l.orientation.attachHandler(this._updateStickyHeader,this);}this._updateCurrentTimeVisualization(false);if(this.getHeight()){var j=this.getDomRef().querySelector("table");var G1=this.$().height()-this._oInfoToolbar.$().height()-this._getTableHeaderToolbar().$().height()+"px";j.style.height=G1;}};$.prototype.setStartDate=function(i){var j,G1;if(!i){i=new Date();}else{b._checkJSDateObject(i);}if(this.getViewKey()===J.Week){j=b.getFirstDateOfWeek(b._createUniversalUTCDate(i,undefined,true));i.setTime(b._createLocalDate(j,true).getTime());}if(this.getViewKey()===J.OneMonth||this.getViewKey()===J.Month){G1=b.getFirstDateOfMonth(b._createUniversalUTCDate(i,undefined,true));i.setTime(b._createLocalDate(G1,true).getTime());}if(z(i,this.getStartDate())){this._updateTodayButtonState();return this;}var H1=i.getFullYear();b._checkYearInValidRange(H1);var I1=this.getMinDate();if(I1&&I1.getTime()>i.getTime()){L.warning("StartDate < minDate -> StartDate set to minDate",this);i=new Date(I1.getTime());}else{var J1=this.getMaxDate();if(J1&&J1.getTime()<i.getTime()){L.warning("StartDate > maxDate -> StartDate set to minDate",this);if(I1){i=new Date(I1.getTime());}else{i=new Date(1,0,1);i.setFullYear(1);}}}this.setProperty("startDate",i,true);_.forEach(function(K1){if(this[K1]){this[K1].setStartDate(new Date(i.getTime()));}},this);this._setRowsStartDate(new Date(i.getTime()));if(this.getViewKey()===J.Week||this.getViewKey()===J.OneMonth){this._updateTodayButtonState();}if(this.getDomRef()){this._updateCurrentTimeVisualization(false);}return this;};$.prototype.setMinDate=function(i){if(z(i,this.getMinDate())){return this;}var j=this.getMaxDate();if(i){b._checkJSDateObject(i);var G1=i.getFullYear();b._checkYearInValidRange(G1);this.setProperty("minDate",i,true);this._bNoStartDateChange=true;_.forEach(function(J1){if(this[J1]){this[J1].setMinDate(new Date(i.getTime()));}},this);if(j&&j.getTime()<i.getTime()){L.warning("minDate > maxDate -> maxDate set to end of the month",this);j=new Date(i.getTime());j.setMonth(j.getMonth()+1,0);j.setHours(23);j.setMinutes(59);j.setSeconds(59);j.setMilliseconds(0);this.setMaxDate(j);}this._bNoStartDateChange=undefined;var H1=this.getStartDate();if(H1&&H1.getTime()<i.getTime()){L.warning("StartDate < minDate -> StartDate set to minDate",this);H1=new Date(i.getTime());this.setStartDate(H1);}}else{this.setProperty("minDate",undefined,true);_.forEach(function(J1){if(this[J1]){this[J1].setMinDate();}},this);}var I1=new Date();if(i&&I1.getTime()<i.getTime()){this._oTodayButton.setVisible(false);}else if(!j||I1.getTime()<j.getTime()){this._oTodayButton.setVisible(true);}return this;};$.prototype.setMaxDate=function(i){if(z(i,this.getMaxDate())){return this;}var j=this.getMinDate();if(i){b._checkJSDateObject(i);var G1=i.getFullYear();b._checkYearInValidRange(G1);this.setProperty("maxDate",i,true);this._bNoStartDateChange=true;_.forEach(function(J1){if(this[J1]){this[J1].setMaxDate(new Date(i.getTime()));}},this);if(j&&j.getTime()>i.getTime()){L.warning("maxDate < minDate -> maxDate set to begin of the month",this);j=new Date(i.getTime());j.setDate(1);j.setHours(0);j.setMinutes(0);j.setSeconds(0);j.setMilliseconds(0);this.setMinDate(j);}this._bNoStartDateChange=undefined;var H1=this.getStartDate();if(H1&&H1.getTime()>i.getTime()){L.warning("StartDate > maxDate -> StartDate set to minDate",this);if(j){H1=new Date(j.getTime());}else{H1=new Date(1,0,1);H1.setFullYear(1);}this.setStartDate(H1);}}else{this.setProperty("maxDate",undefined,true);_.forEach(function(J1){if(this[J1]){this[J1].setMaxDate();}},this);}var I1=new Date();if(i&&I1.getTime()>i.getTime()){this._oTodayButton.setVisible(false);}else if(!j||I1.getTime()>j.getTime()){this._oTodayButton.setVisible(true);}return this;};$.prototype.removeIntervalInstanceFromInfoToolbar=function(){var i=this._oInfoToolbar.getContent();i.forEach(function(j){if(j.isA(e1)){this._oInfoToolbar.removeContent(j);}}.bind(this));};$.prototype.setViewKey=function(j){var G1,H1,I1,J1=this.getViewKey(),K1;this.setProperty("viewKey",j,true);this._oIntervalTypeSelect.setSelectedKey(j);this.removeIntervalInstanceFromInfoToolbar();if(j===J.Week||j===J.OneMonth||j===J.Month){H1=this.getStartDate();this.setStartDate(new Date(H1.getTime()));if(H1.getTime()!==this.getStartDate().getTime()){this.fireStartDateChange();}}var L1=this.getStartDate();var M1=this.getMinDate();var N1=this.getMaxDate();var O1=this._getView(j,!this._bBeforeRendering);if(!O1){this._bCheckView=true;this.invalidate();}else{var P1=O1.getIntervalType();var Q1=this._getIntervals(O1);this._bCheckView=false;switch(P1){case V.Hour:if(!this._oTimeInterval){this._oTimeInterval=new sap.ui.unified.CalendarTimeInterval(this.getId()+"-TimeInt",{startDate:new Date(L1.getTime()),items:Q1,pickerPopup:true,legend:this.getLegend()});this._setAriaRole(this._oTimeInterval);this._oTimeInterval.attachEvent("startDateChange",this._handleStartDateChange,this);this._oTimeInterval.attachEvent("select",this._handleCalendarSelect,this);this._oTimeInterval._oPlanningCalendar=this;this._oTimeInterval.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates();};if(M1){this._oTimeInterval.setMinDate(new Date(M1.getTime()));}if(N1){this._oTimeInterval.setMaxDate(new Date(N1.getTime()));}}else if(this._oTimeInterval.getItems()!=Q1){this._oTimeInterval.setItems(Q1);}this._insertInterval(this._oTimeInterval);break;case V.Day:case V.Week:case V.OneMonth:I1=a1[P1];G1=this[I1.sInstanceName];if(!G1){G1=new I1.oClass(this.getId()+I1.sIdSuffix,{startDate:new Date(L1.getTime()),days:Q1,showDayNamesLine:this.getShowDayNamesLine(),pickerPopup:true,legend:this.getLegend(),showWeekNumbers:this.getShowWeekNumbers()});this._setAriaRole(G1);G1.attachEvent("startDateChange",this._handleStartDateChange,this);G1.attachEvent("select",this._handleCalendarSelect,this);if(j===J.OneMonth){G1._setRowsStartDate=this._setRowsStartDate.bind(this);}G1._oPlanningCalendar=this;G1.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates();};if(M1){G1.setMinDate(new Date(M1.getTime()));}if(N1){G1.setMaxDate(new Date(N1.getTime()));}}else if(G1.getDays()!==Q1){G1.setDays(Q1);}this._insertInterval(G1);this[I1.sInstanceName]=G1;break;case V.Month:if(!this._oMonthInterval){this._oMonthInterval=new sap.ui.unified.CalendarMonthInterval(this.getId()+"-MonthInt",{startDate:new Date(L1.getTime()),months:Q1,pickerPopup:true,legend:this.getLegend()});this._setAriaRole(this._oMonthInterval);this._oMonthInterval.attachEvent("startDateChange",this._handleStartDateChange,this);this._oMonthInterval.attachEvent("select",this._handleCalendarSelect,this);this._oMonthInterval._oPlanningCalendar=this;this._oMonthInterval.getSpecialDates=function(){return this._oPlanningCalendar.getSpecialDates();};if(M1){this._oMonthInterval.setMinDate(new Date(M1.getTime()));}if(N1){this._oMonthInterval.setMaxDate(new Date(N1.getTime()));}}else if(this._oMonthInterval.setMonths()!=Q1){this._oMonthInterval.setMonths(Q1);}this._insertInterval(this._oMonthInterval);break;default:throw new Error("Unknown IntervalType: "+P1+"; "+this);}var R1=this.getRows();for(var i=0;i<R1.length;i++){var S1=R1[i];var T1=v1(S1);T1.setIntervalType(P1);T1.setIntervals(Q1);T1.setShowSubIntervals(O1.getShowSubIntervals());}if(this.getDomRef()){this._updateCurrentTimeVisualization(false);i1.call(this,this.getShowWeekNumbers(),this._viewAllowsWeekNumbers(j));j1.call(this,this.getShowDayNamesLine(),!!G1);}}if(this._oOneMonthInterval&&j===J.OneMonth){this._oOneMonthInterval._setDisplayMode(this._iSize);this._oOneMonthInterval._adjustSelectedDate(c.fromLocalJSDate(H1));if(this._iSize<2){this._setRowsStartDate(H1);}}else if(this._oOneMonthInterval&&J1===J.OneMonth&&this._oOneMonthInterval.getSelectedDates().length){K1=this._oOneMonthInterval.getSelectedDates()[0].getStartDate();if(K1){this.setStartDate(K1);}}this._updateTodayButtonState();return this;};$.prototype._insertInterval=function(i){if(this._iSizeScreen>1){this._oInfoToolbar.addContent(i);}else{this._oInfoToolbar.insertContent(i,1);}};$.prototype._viewAllowsWeekNumbers=function(i){var j=this._getView(i).getIntervalType(),G1=a1[j];return!!G1&&!!G1.oClass.prototype.setShowWeekNumbers;};$.prototype._viewAllowsDayNamesLine=function(i){var j=this._getView(i).getIntervalType(),G1=a1[j];return!!G1&&!!G1.oClass.prototype.setShowDayNamesLine;};$.prototype._getIntervalInstanceByViewKey=function(i){var j=this._getView(i).getIntervalType(),G1=a1[j],H1;if(G1){H1=this[G1.sInstanceName];}return H1;};$.prototype.setShowWeekNumbers=function(i){this.setProperty("showWeekNumbers",i,true);this._getViews().forEach(function(j){var G1=j.getKey(),H1=this._viewAllowsWeekNumbers(G1),I1=this._getIntervalInstanceByViewKey(G1);if(I1&&H1){this._getIntervalInstanceByViewKey(G1).setShowWeekNumbers(i);}if(this.getDomRef()&&this.getViewKey()===G1){i1.call(this,i,H1);}},this);return this;};$.prototype.setShowIntervalHeaders=function(j){this.setProperty("showIntervalHeaders",j,true);var G1=this.getRows();for(var i=0;i<G1.length;i++){var H1=G1[i];v1(H1).setShowIntervalHeaders(j);}return this;};$.prototype.setShowEmptyIntervalHeaders=function(j){this.setProperty("showEmptyIntervalHeaders",j,true);var G1=this.getRows();for(var i=0;i<G1.length;i++){var H1=G1[i];v1(H1).setShowEmptyIntervalHeaders(j);}return this;};$.prototype.setGroupAppointmentsMode=function(j){this.setProperty("groupAppointmentsMode",j,true);var G1=this.getRows();for(var i=0;i<G1.length;i++){var H1=G1[i];v1(H1).setGroupAppointmentsMode(j);}return this;};$.prototype.setAppointmentsReducedHeight=function(j){this.setProperty("appointmentsReducedHeight",j,true);var G1=this.getRows();for(var i=0;i<G1.length;i++){var H1=G1[i];v1(H1).setAppointmentsReducedHeight(j);}return this;};$.prototype.setAppointmentsVisualization=function(j){this.setProperty("appointmentsVisualization",j,true);var G1=this.getRows();for(var i=0;i<G1.length;i++){var H1=G1[i];v1(H1).setAppointmentsVisualization(j);}return this;};$.prototype.setShowRowHeaders=function(i){this.setProperty("showRowHeaders",i,true);var j=this.getAggregation("table");j.getColumns()[0].setVisible(i);this._toggleAppointmentsColumnPopinState(i);this.$().toggleClass("sapMPlanCalNoHead",!i);D1.call(this);E1.call(this);return this;};$.prototype.setShowDayNamesLine=function(i){var j,G1,H1,I1=!!this.getDomRef(),J1=this.getViewKey();for(j in a1){G1=a1[j].sInstanceName;if(this[G1]){H1=this[G1];H1.setShowDayNamesLine(i);if(I1&&j===J1){j1.call(this,i,true);}}}return this.setProperty("showDayNamesLine",i,false);};$.prototype.setStickyHeader=function(i){if(this.getStickyHeader()===i){return this;}this.setProperty("stickyHeader",i,true);if(l.system.phone){if(i){l.orientation.attachHandler(this._updateStickyHeader,this);}else{l.orientation.detachHandler(this._updateStickyHeader,this);}}this._updateStickyHeader();return this;};$.prototype._updateStickyHeader=function(){var i=[],j=this.getStickyHeader(),G1=this.getViewKey()===J.OneMonth&&this._iSize<2,H1=j&&!l.system.phone&&!G1,I1=j&&!(l.system.phone&&l.orientation.landscape)&&!G1;if(H1){i.push(sap.m.Sticky.HeaderToolbar);}if(this._oInfoToolbar&&I1){i.push(sap.m.Sticky.InfoToolbar);}this.getAggregation("table").setSticky(i);};$.prototype.addRow=function(i){this.addAggregation("rows",i,true);this.getAggregation("table").addItem(this._createPlanningCalendarListItem(i));return this;};$.prototype.insertRow=function(i,j){this.insertAggregation("rows",i,j);this.getAggregation("table").insertItem(this._createPlanningCalendarListItem(i),j,true);return this;};$.prototype.removeRow=function(i){var j=this.removeAggregation("rows",i,true),G1=this.getAggregation("table");G1.removeItem(t1(j),true);this._handleRowRemoval(j);C1.call(this);E1.call(this);return j;};$.prototype.removeAllRows=function(){var i=this.removeAllAggregation("rows",true),j=this.getAggregation("table");j.removeAllItems(true);i.forEach(this._handleRowRemoval,this);C1.call(this);E1.call(this);return i;};$.prototype.destroyRows=function(){var i=this.destroyAggregation("rows",true);var j=this.getAggregation("table");j.destroyItems(true);C1.call(this);E1.call(this);return i;};$.prototype.setSingleSelection=function(i){this.setProperty("singleSelection",i,true);D1.call(this);E1.call(this);if(i){this.selectAllRows(false);}else{C1.call(this);}this.$().toggleClass("sapMPlanCalMultiSel",!i);return this;};$.prototype.setNoDataText=function(i){this.setProperty("noDataText",i,true);var j=this.getAggregation("table");j.setNoDataText(i);return this;};$.prototype.setLegend=function(j){this.setAssociation("legend",j,true);var G1=this.getRows(),H1=this.getLegend()&&sap.ui.getCore().byId(this.getLegend()),I1;for(var i=0;i<G1.length;i++){var J1=G1[i];v1(J1).setLegend(j);}_.forEach(function(K1){if(this[K1]){this[K1].setLegend(j);}},this);if(H1){I1=new a(function(K1){this.invalidate();}.bind(this));I1.observe(H1,{destroy:true});}return this;};$.prototype.addAriaLabelledBy=function(i){this.addAssociation("ariaLabelledBy",i,true);var j=this.getAggregation("table");j.addAriaLabelledBy(i);return this;};$.prototype.removeAriaLabelledBy=function(i){this.removeAssociation("ariaLabelledBy",i,true);var j=this.getAggregation("table");j.removeAriaLabelledBy(i);return this;};$.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);var i=this.getAggregation("table");i.removeAllAriaLabelledBy();i.addAriaLabelledBy(this.getId()+"-Descr");return this;};$.prototype.invalidate=function(i){var j=i&&i instanceof D;if(!this._bIsBeingDestroyed&&(this._bDateRangeChanged||j)){if(this.getDomRef()){var G1=this.getViewKey();var H1=this._getView(G1);var I1=H1.getIntervalType();switch(I1){case V.Hour:if(this._oTimeInterval){this._oTimeInterval.invalidate(arguments);}break;case V.Day:if(this._oDateInterval){this._oDateInterval.invalidate(arguments);}break;case V.Month:if(this._oMonthInterval){this._oMonthInterval.invalidate(arguments);}break;case V.OneMonth:if(this._oOneMonthInterval){this._oOneMonthInterval.invalidate(arguments);}break;case V.Week:if(this._oWeekInterval){this._oWeekInterval.invalidate(arguments);}break;default:throw new Error("Unknown IntervalType: "+I1+"; "+this);}}this._bDateRangeChanged=undefined;}else{if(i&&i instanceof sap.m.PlanningCalendarView){this._bCheckView=true;}C.prototype.invalidate.apply(this,arguments);}};$.prototype.addSpecialDate=function(i){this._bDateRangeChanged=true;return C.prototype.addAggregation.call(this,"specialDates",i);};$.prototype.insertSpecialDate=function(i,j){this._bDateRangeChanged=true;return C.prototype.insertAggregation.call(this,"specialDates",i,j);};$.prototype.removeSpecialDate=function(i){this._bDateRangeChanged=true;return C.prototype.removeAggregation.call(this,"specialDates",i);};$.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;return this.removeAllAggregation("specialDates");};$.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;return this.destroyAggregation("specialDates");};$.prototype.removeAllViews=function(){this._bCheckView=true;var i=this.removeAllAggregation("views"),j=this.getBuiltInViews();if(j.length){this.setViewKey(j[0]);}else{this.setViewKey(c1[0]);}return i;};$.prototype.destroyViews=function(){this._bCheckView=true;var i=this.destroyAggregation("views"),j=this.getBuiltInViews();if(j.length){this.setViewKey(j[0]);}else{this.setViewKey(c1[0]);}return i;};$.prototype.getSelectedRows=function(){return this.getRows().filter(function(i){return i.getSelected();});};$.prototype.selectAllRows=function(j){var G1=this.getRows();if(!(j&&this.getSingleSelection())){for(var i=0;i<G1.length;i++){var H1=G1[i];H1.setSelected(j);}if(this._oSelectAllCheckBox){this._oSelectAllCheckBox.setSelected(j);}}return this;};$.prototype.onsaphomemodifiers=function(i){if((i.metaKey||i.ctrlKey)&&!i.altKey&&!i.shiftKey){var j=this.getRows();var G1=j[0];var H1=new Q.Event("saphome");H1._bPlanningCalendar=true;v1(G1).onsaphome(H1);i.preventDefault();i.stopPropagation();}};$.prototype.onsapendmodifiers=function(i){if((i.metaKey||i.ctrlKey)&&!i.altKey&&!i.shiftKey){var j=this.getRows();var G1=j[j.length-1];var H1=new Q.Event("sapend");H1._bPlanningCalendar=true;v1(G1).onsapend(H1);i.preventDefault();i.stopPropagation();}};$.prototype.setBuiltInViews=function(i){this.setProperty("builtInViews",i);this.setViewKey(this._getViews()[0].getKey());return this;};$.prototype.removeView=function(i){var j=this.removeAggregation("views",i);if(!this.getViews().length){this.setViewKey(this._getViews()[0].getKey());}return j;};$.prototype._getIntervals=function(i){var j=0;switch(this._iSize){case 0:j=i.getIntervalsS();break;case 1:j=i.getIntervalsM();break;default:j=i.getIntervalsL();break;}return j;};$.prototype._getView=function(j,G1){var H1=this._getViews();var I1;for(var i=0;i<H1.length;i++){I1=H1[i];if(I1.getKey()!=j){I1=undefined;}else{break;}}if(!I1&&!G1){throw new Error("PlanningCalendarView with key "+j+"not assigned "+this);}return I1;};$.prototype._changeStartDate=function(i){if(this._bNoStartDateChange){return;}this.setStartDate(new Date(i.getTime()));this.fireStartDateChange();};$.prototype._updateCurrentTimeVisualization=function(j){if(this._sUpdateCurrentTime){clearTimeout(this._sUpdateCurrentTime);this._sUpdateCurrentTime=undefined;}if(j){var G1=this.getRows();for(var i=0;i<G1.length;i++){var H1=G1[i];v1(H1).updateCurrentTimeVisualization();}}var I1=new Date();var J1=this.getStartDate();var K1=this.getViewKey();var L1=this._getView(K1);var M1=L1.getIntervalType();var N1=this._getIntervals(L1);var O1=0;var P1=0;var Q1=0;switch(M1){case V.Hour:O1=60000;P1=J1.getTime()-3600000;Q1=J1.getTime()+N1*3600000;break;case V.Day:case V.Week:case V.OneMonth:O1=1800000;P1=J1.getTime()-3600000;Q1=J1.getTime()+N1*86400000;break;default:O1=-1;break;}if(I1.getTime()<=Q1&&I1.getTime()>=P1&&O1>0){this._sUpdateCurrentTime=setTimeout(this['_updateCurrentTimeVisualization'].bind(this,true),O1);}};function g1(i){this.setViewKey(i.getParameter("selectedItem").getKey());this.fireViewChange();}$.prototype._handleTodayPress=function(i){var j=new Date(),G1,H1=this.getViewKey();if(H1===J.OneMonth){G1=b.getFirstDateOfMonth(b._createUniversalUTCDate(j,undefined,true));this._oOneMonthInterval._adjustSelectedDate(c.fromLocalJSDate(j),false);j=b._createLocalDate(G1,true);}if(H1===J.Week){G1=this.getStartDate();j.setHours(G1.getHours());j.setMinutes(G1.getMinutes());j.setSeconds(G1.getSeconds());}this.setStartDate(j);this.fireStartDateChange();};$.prototype._handleStartDateChange=function(i){var j=i.oSource.getStartDate();this._changeStartDate(j);};$.prototype._handleCalendarSelect=function(i){var j=i.oSource.getSelectedDates();var G1=new Date(j[0].getStartDate());var H1=b._createUniversalUTCDate(G1,undefined,true);var I1=this.getViewKey();var J1=this._getView(I1);var K1=J1.getIntervalType();if(K1!==V.OneMonth||this._iSize>1){j[0].setStartDate();}switch(K1){case V.Hour:H1.setUTCHours(H1.getUTCHours()+1);break;case V.Day:case V.Week:H1.setUTCDate(H1.getUTCDate()+1);break;case V.OneMonth:if(this._iSize<2){var L1=new Date(G1.getTime());if(b.monthsDiffer(this.getStartDate(),G1)){this.setStartDate(G1);}this._setRowsStartDate(L1);this._oOneMonthInterval.getAggregation('month')[0]._focusDate(c.fromLocalJSDate(L1),true);}else if(b._isNextMonth(G1,this.getStartDate())){this._oOneMonthInterval._handleNext();return;}H1.setUTCDate(H1.getUTCDate()+1);break;case V.Month:H1.setUTCMonth(H1.getUTCMonth()+1);break;default:throw new Error("Unknown IntervalType: "+K1+"; "+this);}H1.setUTCMilliseconds(H1.getUTCMilliseconds()-1);H1=b._createLocalDate(H1,true);this.fireIntervalSelect({startDate:G1,endDate:H1,subInterval:false,row:undefined});};function h1(i){var j=i.getParameter("startDate");var G1=this.getViewKey();var H1=this._getView(G1);var I1=H1.getIntervalType();if(I1===V.OneMonth&&b._isNextMonth(j,this.getStartDate())){this._oOneMonthInterval._handleNext();return;}var J1=i.getParameter("endDate");var K1=i.getParameter("subInterval");var L1=s1(i.oSource.getParent());this.fireIntervalSelect({startDate:j,endDate:J1,subInterval:K1,row:L1});}$.prototype._applyContextualSettings=function(i){return C.prototype._applyContextualSettings.call(this,i||M._defaultContextualSettings);};$.prototype._getTableHeaderToolbar=function(){return this.getAggregation("table").getHeaderToolbar();};function i1(i,j){this.$().toggleClass("sapMPlanCalWithWeekNumbers",i&&j);}function j1(i,j){this.$().toggleClass("sapMPlanCalWithDayNamesLine",i&&j);}function k1(j,G1){if(j.size.width<=0){return;}if(Math.abs(this.iWidth-j.size.width)<15){return;}this.iWidth=j.size.width;this._applyContextualSettings({contextualWidth:this.iWidth});var H1=this.getRows();var I1;var i=0;var J1=this._iSize;x1.call(this,j.size.width);if(J1!=this._iSize){y1.call(this,this._iSize);var K1=this.getViewKey();var L1=this._getView(K1);var M1=L1.getIntervalType();var N1=this._getIntervals(L1);for(i=0;i<H1.length;i++){I1=H1[i];var O1=v1(I1);if(N1!=O1.getIntervals()){O1.setIntervals(N1);}else{O1.handleResize();}}switch(M1){case V.Hour:if(this._oTimeInterval&&this._oTimeInterval.getItems()!=N1){this._oTimeInterval.setItems(N1);}break;case V.Day:if(this._oDateInterval&&this._oDateInterval.getDays()!=N1){this._oDateInterval.setDays(N1);}break;case V.Month:if(this._oMonthInterval&&this._oMonthInterval.getMonths()!=N1){this._oMonthInterval.setMonths(N1);}break;case V.Week:if(this._oWeekInterval&&this._oWeekInterval.getDays()!=N1){this._oWeekInterval.setDays(N1);}break;case V.OneMonth:if(this._oOneMonthInterval&&this._oOneMonthInterval.getDays()!=N1){this._oOneMonthInterval.setDays(N1);if(this._iSize>1){this._setRowsStartDate(new Date(this.getStartDate().getTime()));}}break;default:throw new Error("Unknown IntervalType: "+M1+"; "+this);}D1.call(this);}else if(!G1){for(i=0;i<H1.length;i++){I1=H1[i];v1(I1).handleResize();}}if(this._oOneMonthInterval){this._oOneMonthInterval._setDisplayMode(this._iSize);}if(this.getStickyHeader()){this._updateStickyHeader();}}function l1(G1){var H1=G1.getParameter("appointment"),I1=G1.getParameter("multiSelect"),J1=G1.getParameter("appointments"),K1=G1.getParameter("domRefId"),L1,M1,N1,O1,P1,i,j;if(!I1){M1=this.getRows();for(i=0;i<M1.length;i++){N1=M1[i];if(G1.oSource!=v1(N1)){O1=N1.getAppointments();for(j=0;j<O1.length;j++){P1=O1[j];P1.setSelected(false);}}}}L1={appointment:H1,appointments:J1,multiSelect:I1,domRefId:K1};this.fireAppointmentSelect(L1);}$.prototype._setRowsStartDate=function(j){var G1=this.getRows(),H1,i;for(i=0;i<G1.length;i++){H1=G1[i];v1(H1).setStartDate(j);}};$.prototype._toggleAppointmentsColumnPopinState=function(i){var j=this.getAggregation("table"),G1=j.getColumns()[1];G1.setDemandPopin(i);G1.setMinScreenWidth(i?b1:"");};$.prototype._getViews=function(){var i=this.getViews(),j=this.getBuiltInViews(),G1,H1=[],I1=J,J1=V;if(!this._oViews){this._oViews={};}if(j.length){H1=j;}else{H1=i.length?[]:c1;}G1=H1.map(function(L1){switch(L1){case I1.Hour:return this._oViews[I1.Hour]||(this._oViews[I1.Hour]=new sap.m.PlanningCalendarView(this.getId()+"-HourView",{key:I1.Hour,intervalType:J1.Hour,description:this._oRB.getText("PLANNINGCALENDAR_HOURS"),intervalsS:6,intervalsM:6,intervalsL:12}));case I1.Day:return this._oViews[I1.Day]||(this._oViews[I1.Day]=new sap.m.PlanningCalendarView(this.getId()+"-DayView",{key:I1.Day,intervalType:J1.Day,description:this._oRB.getText("PLANNINGCALENDAR_DAYS"),intervalsS:7,intervalsM:7,intervalsL:14}));case I1.Month:return this._oViews[I1.Month]||(this._oViews[I1.Month]=new sap.m.PlanningCalendarView(this.getId()+"-MonthView",{key:I1.Month,intervalType:J1.Month,description:this._oRB.getText("PLANNINGCALENDAR_MONTHS"),intervalsS:3,intervalsM:6,intervalsL:12}));case I1.Week:return this._oViews[I1.Week]||(this._oViews[I1.Week]=new sap.m.PlanningCalendarView(this.getId()+"-WeekView",{key:I1.Week,intervalType:J1.Week,description:this._oRB.getText("PLANNINGCALENDAR_WEEK"),intervalsS:7,intervalsM:7,intervalsL:7}));case I1.OneMonth:return this._oViews[I1.OneMonth]||(this._oViews[I1.OneMonth]=new sap.m.PlanningCalendarView(this.getId()+"-OneMonthView",{key:I1.OneMonth,intervalType:J1.OneMonth,description:this._oRB.getText("PLANNINGCALENDAR_ONE_MONTH"),intervalsS:1,intervalsM:1,intervalsL:31}));default:L.error("Cannot get PlanningCalendar views. Invalid view key "+L1);break;}},this);for(var K1 in this._oViews){if(H1.indexOf(K1)<0){this._oViews[K1].destroy();delete this._oViews[K1];}}if(i.length){G1=G1.concat(i);}return G1;};$.prototype.getSelectedAppointments=function(){var i=[];this.getRows().filter(function(j){i.push.apply(i,v1(j).aSelectedAppointments);});return i;};$.prototype.setCustomAppointmentsSorterCallback=function(i){if(typeof i==="function"||i===null||i===undefined){this.getRows().forEach(function(j){v1(j)._setCustomAppointmentsSorterCallback(i);});this._fnCustomSortedAppointments=i;}else{L.warning("Your custom sort function won't be used, but the old one will be preserved.",this);}return this;};$.prototype.getCustomAppointmentsSorterCallback=function(){return this._fnCustomSortedAppointments;};$.prototype._onRowDeselectAppointment=function(){var G1=this.getRows();for(var i=0;i<G1.length;i++){var H1=v1(G1[i]).aSelectedAppointments;for(var j=0;j<H1.length;j++){var I1=sap.ui.getCore().byId(H1[j]);if(I1){I1.setProperty("selected",false,true);I1.$().removeClass("sapUiCalendarAppSel");}}v1(G1[i]).aSelectedAppointments=[];}};$.prototype._updateRowTimeline=function(i){var j=v1(i),G1,H1,I1,J1;j.setNonWorkingDays(i.getNonWorkingDays());j.setNonWorkingHours(i.getNonWorkingHours());j.setStartDate(this.getStartDate());j.setShowIntervalHeaders(this.getShowIntervalHeaders());j.setShowEmptyIntervalHeaders(this.getShowEmptyIntervalHeaders());j.setGroupAppointmentsMode(this.getGroupAppointmentsMode());j.setAppointmentsReducedHeight(this.getAppointmentsReducedHeight());j.setLegend(this.getLegend());j.setAppointmentsVisualization(this.getAppointmentsVisualization());j.attachEvent("select",l1,this);j.attachEvent("startDateChange",this._handleStartDateChange,this);j.attachEvent("leaveRow",B1,this);j.attachEvent("intervalSelect",h1,this);C1.call(this);if(F1.call(this)){G1=this.getViewKey();H1=this._getView(G1);I1=H1.getIntervalType();J1=this._getIntervals(H1);j.setIntervalType(I1);j.setIntervals(J1);j.setShowSubIntervals(H1.getShowSubIntervals());}E1.call(this);if(this._fnCustomSortedAppointments){j._setCustomAppointmentsSorterCallback(this._fnCustomSortedAppointments);}};$.prototype._observeRowChanges=function(i){var j=t1(i),G1=u1(i),H1=v1(i);var I1={destroy:function(){j.destroy();},change:{title:function(J1){G1.setProperty(J1.name,J1.current);},icon:function(J1){G1.setProperty(J1.name,J1.current);},text:function(J1){H1.toggleStyleClass("sapMPlanCalRowLarge",!!J1.current);G1.setProperty("description",J1.current);},enableAppointmentsDragAndDrop:function(J1){this._enableAppointmentsDragAndDrop(i);}.bind(this),enableAppointmentsResize:function(J1){this._enableAppointmentsResize(i);}.bind(this),enableAppointmentsCreate:function(J1){this._enableAppointmentsCreate(i);}.bind(this),nonWorkingDays:function(J1){H1.setProperty(J1.name,J1.current);},nonWorkingHours:function(J1){H1.setProperty(J1.name,J1.current);},selected:function(J1){C1.call(this);j.setProperty(J1.name,J1.current);}.bind(this),intervalHeaders:function(J1){H1.invalidate();},appointments:function(J1){H1.invalidate();}}};new a(function(J1){if(J1.type==="destroy"){I1.destroy();}else if(I1.change[J1.name]){I1.change[J1.name](J1);}}).observe(i,{properties:["icon","text","title","nonWorkingDays","nonWorkingHours","selected","enableAppointmentsDragAndDrop","enableAppointmentsResize","enableAppointmentsCreate"],aggregations:["appointments","intervalHeaders"],destroy:true});i.invalidate=function(J1){if(!J1||!(J1 instanceof d)){E.prototype.invalidate.apply(this,arguments);}else if(j){H1.invalidate(J1);}};i.applyFocusInfo=function(J1){H1.applyFocusInfo(J1);return this;};};$.prototype._createPlanningCalendarListItem=function(i){var j,G1,H1;G1=new m1(i.getId()+"-Head",{icon:i.getIcon(),description:i.getText(),title:i.getTitle()});H1=new o1(i.getId()+"-CalRow",{checkResize:false,updateCurrentTime:false,ariaLabelledBy:G1.getId()});H1.getAppointments=function(){return i.getAppointments();};H1.getIntervalHeaders=function(){return i.getIntervalHeaders();};j=new q1(i.getId()+Z,{cells:[G1,H1]});this._updateRowTimeline(i);this._observeRowChanges(i);this._enableAppointmentsDragAndDrop(i);this._enableAppointmentsResize(i);this._enableAppointmentsCreate(i);return j;};$.prototype._handleRowRemoval=function(i){var j=v1(i);j.detachEvent("select",l1,this);j.detachEvent("startDateChange",this._handleStartDateChange,this);j.detachEvent("leaveRow",B1,this);j.detachEvent("intervalSelect",h1,this);if(this._fnCustomSortedAppointments){j._fnCustomSortedAppointments=undefined;}t1(i).destroy();};var m1=v.extend("PlanningCalendarRowHeader",{renderer:R.extend(w)});PlanningCalendarRowHeaderRenderer.openItemTag=function(i,j){i.write("<div");};PlanningCalendarRowHeaderRenderer.closeItemTag=function(i,j){i.write("</div>");};PlanningCalendarRowHeaderRenderer.renderTabIndex=function(i,j){};var n1=R.extend(f);n1.getLegendItems=function(i){var j=[],G1,H1=i.getLegend();if(H1){G1=sap.ui.getCore().byId(H1);if(G1){j=G1.getAppointmentItems?G1.getAppointmentItems():G1.getItems();}else{L.error("PlanningCalendarLegend with id '"+H1+"' does not exist!",i);}}return j;};n1.renderBeforeAppointments=function(j,G1){var H1=s1(G1.getParent()),I1;if(!H1.getEnableAppointmentsDragAndDrop()&&!H1.getEnableAppointmentsResize()&&!H1.getEnableAppointmentsCreate()||G1._isOneMonthIntervalOnSmallSizes()){return;}I1=G1.getAggregation("_intervalPlaceholders");j.write("<div class=\"sapUiCalendarRowAppsOverlay\">");if(I1){for(var i=0;i<I1.length;i++){var J1=I1[i];J1.setWidth(100/I1.length+"%");j.renderControl(J1);}}j.write("</div>");};n1.renderResizeHandle=function(i,j,G1){if(!s1(j.getParent()).getEnableAppointmentsResize()||j._isOneMonthIntervalOnSmallSizes()||(G1._aAppointments&&G1._aAppointments.length>0)){return;}i.write("<span");i.addClass("sapUiCalendarAppResizeHandle");i.writeClasses();i.write(">");i.write("</span>");};n1.writeCustomAttributes=function(i,j){if(s1(j.getParent()).getEnableAppointmentsCreate()){i.writeAttribute("draggable","true");}};n1.renderInterval=function(j,G1,H1,I1,J1,K1,L1,M1,N1,O1,P1,Q1,R1){var S1=G1.getIntervalType();if(S1===V.Day||S1===V.Week||S1===V.OneMonth){var T1=s1(G1.getParent()),U1=T1.getParent(),V1=function(d2){return d2.getType()===A.NonWorking;},W1=T1.getSpecialDates().filter(V1),X1=U1.getSpecialDates().filter(V1),Y1=G1.getStartDate(),Z1,$1,_1,a2;if(X1&&W1){Z1=X1.concat(W1);}else if(W1){Z1=W1;}if(Z1&&Z1.length){var b2=function(d2){return d2===$1.getDay();};$1=new Date(Y1.getTime());$1.setHours(0,0,0);$1.setDate(Y1.getDate()+H1);for(var i=0;i<Z1.length;i++){if(Z1[i].getStartDate()){_1=new Date(Z1[i].getStartDate().getTime());}if(Z1[i].getEndDate()){a2=new Date(Z1[i].getEndDate().getTime());}else{a2=new Date(Z1[i].getStartDate().getTime());a2.setHours(23,59,59);}if($1.getTime()>=_1.getTime()&&$1.getTime()<=a2.getTime()){var c2=K1.some(b2);if(!c2){j.addClass("sapUiCalendarRowAppsNoWork");}}}}}f.renderInterval(j,G1,H1,I1,J1,K1,L1,M1,N1,O1,P1,Q1,R1);};var o1=e.extend("PlanningCalendarRowTimeline",{metadata:{aggregations:{intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:true},_intervalPlaceholders:{type:"IntervalPlaceholder",multiple:true,visibility:"hidden",dnd:{droppable:true}}}},renderer:n1});o1.prototype._updatePlaceholders=function(){var j=this.getProperty("intervals");if(this.getIntervalType()===V.Hour){j*=2;}this.removeAllAggregation("_intervalPlaceholders");for(var i=0;i<j;i++){this.addAggregation("_intervalPlaceholders",new p1());}};o1.prototype.onBeforeRendering=function(){e.prototype.onBeforeRendering.call(this);this._updatePlaceholders();};o1.prototype.onmousedown=function(i){var j=i.target.classList;this._isResizeHandleMouseDownTarget=j.contains("sapUiCalendarAppResizeHandle");this._isRowAppsIntervalMouseDownTarget=j.contains("sapUiCalendarRowAppsInt");};o1.prototype._isResizingPerformed=function(){return this._isResizeHandleMouseDownTarget;};o1.prototype._isDraggingPerformed=function(){return!this._isResizeHandleMouseDownTarget&&!this._isRowAppsIntervalMouseDownTarget;};o1.prototype._isCreatingPerformed=function(){return this._isRowAppsIntervalMouseDownTarget;};var p1=C.extend("IntervalPlaceholder",{metadata:{properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null}}},renderer:function(i,j){i.write("<div");i.writeControlData(j);i.addStyle("width",j.getWidth());i.writeStyles();i.addClass("sapUiCalendarRowAppsPlaceholder");i.writeClasses();i.write("></div>");}});var q1=s.extend("sap.m.internal.PlanningCalendarRowListItem",{metadata:{library:"sap.m"},renderer:t});q1.prototype.getHeader=function(){return this.getCells()[0];};q1.prototype.getTimeline=function(){return this.getCells()[1];};q1.prototype.getCustomData=function(){return s1(this).getCustomData();};$.prototype._enableAppointmentsDragAndDrop=function(i){var j=v1(i),G1;if(i.getEnableAppointmentsDragAndDrop()){G1=i.getDragDropConfig().some(function(H1){return H1.getGroupName()===W;});if(!G1){this._addDragDropInfo(i,v1(i));}}else{i.getDragDropConfig().forEach(function(H1){if(H1.getGroupName()===W){i.removeDragDropConfig(H1);}});j.getDragDropConfig().forEach(function(H1){if(H1.getGroupName()===W){j.removeDragDropConfig(H1);}});}};$.prototype._enableAppointmentsResize=function(i){var j=i.getEnableAppointmentsResize(),G1=this._getConfigFromDragDropConfigAggregation(i.getAggregation("dragDropConfig"),X),H1=this._getResizeConfig(i);if(j&&!G1){i.addAggregation("dragDropConfig",H1,true);}if(!j){i.removeAggregation("dragDropConfig",G1,true);}};$.prototype._enableAppointmentsCreate=function(i){var j=i.getEnableAppointmentsCreate(),G1=v1(i),H1=this._getConfigFromDragDropConfigAggregation(G1.getAggregation("dragDropConfig"),Y),I1=this._getAppointmentsCreateConfig(i);if(j&&!H1){G1.addAggregation("dragDropConfig",I1,true);}if(!j){G1.removeAggregation("dragDropConfig",H1,true);}};$.prototype._addDragDropInfo=function(i,j){i.addDragDropConfig(new n({groupName:W,sourceAggregation:"appointments",dragStart:function(G1){var H1=function(){var I1=Q(".sapUiCalendarRowAppsOverlay");setTimeout(function(){I1.addClass("sapUiCalendarRowAppsOverlayDragging");},0);Q(document).one("dragend",function(){I1.removeClass("sapUiCalendarRowAppsOverlayDragging");});};if(j._isOneMonthIntervalOnSmallSizes()||!j._isDraggingPerformed()){G1.preventDefault();return;}H1();}}));j.addDragDropConfig(new o({groupName:W,targetAggregation:"_intervalPlaceholders",dragEnter:function(G1){var H1=G1.getParameter("dragSession"),I1=H1.getDragControl(),J1=j.getIntervalType(),K1=j.getStartDate(),L1=j.indexOfAggregation("_intervalPlaceholders",H1.getDropControl()),M1=j.getId(),N1,O1=function(){var Q1=Q(H1.getIndicator()),R1=H1.getDropControl().getDomRef().getBoundingClientRect(),S1=sap.ui.getCore().byId(M1).getDomRef().getBoundingClientRect(),T1=H1.getDragControl().$().outerWidth(),U1=sap.ui.getCore().getConfiguration().getRTL(),V1=U1?Math.ceil(R1.right)-S1.left:S1.right-Math.ceil(R1.left);Q1.css("min-width",(T1<V1)?T1:V1).css(U1?"border-left-width":"border-right-width",(T1>V1)?"0":"").css("margin-left",U1?-(Q1.outerWidth()-parseFloat(Q1.context.style.width)):"");};if(i.hasListeners("appointmentDragEnter")){if(J1===V.Hour){N1=this._calcNewHoursAppPos(K1,I1.getStartDate(),I1.getEndDate(),L1);}else if(J1===V.Day||J1===V.Week||(J1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){N1=this._calcNewDaysAppPos(K1,I1.getStartDate(),I1.getEndDate(),L1);}else if(J1===V.Month){N1=this._calcNewMonthsAppPos(K1,I1.getStartDate(),I1.getEndDate(),L1);}var P1=i.fireAppointmentDragEnter({appointment:I1,startDate:N1.startDate,endDate:N1.endDate,calendarRow:s1(j.getParent())});if(!P1){G1.preventDefault();return;}}else if(v1(I1.getParent())!==j){G1.preventDefault();return;}if(j.getIntervalType()!==V.Hour){return;}if(!H1.getIndicator()){setTimeout(O1,0);}else{O1();}}.bind(this),drop:function(G1){var H1=G1.getParameter("dragSession"),I1=H1.getDragControl(),J1=j.getIntervalType(),K1=j.getStartDate(),L1=j.indexOfAggregation("_intervalPlaceholders",H1.getDropControl()),M1,N1=G1.getParameter("browserEvent"),O1=(N1.metaKey||N1.ctrlKey);if(J1===V.Hour){M1=this._calcNewHoursAppPos(K1,I1.getStartDate(),I1.getEndDate(),L1);}else if(J1===V.Day||J1===V.Week||(J1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){M1=this._calcNewDaysAppPos(K1,I1.getStartDate(),I1.getEndDate(),L1);}else if(J1===V.Month){M1=this._calcNewMonthsAppPos(K1,I1.getStartDate(),I1.getEndDate(),L1);}j.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");if(I1.getStartDate().getTime()===M1.startDate.getTime()&&I1.getParent()===s1(j.getParent())){return;}i.fireAppointmentDrop({appointment:I1,startDate:M1.startDate,endDate:M1.endDate,calendarRow:s1(j.getParent()),copy:O1});}.bind(this)}));};$.prototype._calcNewHoursAppPos=function(i,j,G1,H1){var I1=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours());I1=new Date(I1.getTime()+(H1*30*60*1000));return{startDate:I1,endDate:new Date(I1.getTime()+G1.getTime()-j.getTime())};};$.prototype._calcNewDaysAppPos=function(i,j,G1,H1){var I1=new Date(i);I1.setDate(I1.getDate()+H1);I1=new Date(I1.getFullYear(),I1.getMonth(),I1.getDate(),j.getHours(),j.getMinutes(),j.getSeconds());return{startDate:I1,endDate:new Date(I1.getTime()+G1.getTime()-j.getTime())};};$.prototype._calcNewMonthsAppPos=function(i,j,G1,H1){var I1=new Date(i);I1.setMonth(I1.getMonth()+H1);I1=new Date(I1.getFullYear(),I1.getMonth(),j.getDate(),j.getHours(),j.getMinutes(),j.getSeconds());return{startDate:I1,endDate:new Date(I1.getTime()+G1.getTime()-j.getTime())};};$.prototype._getResizeConfig=function(i){var j=v1(i),G1=new p({sourceAggregation:"appointments",targetAggregation:"_intervalPlaceholders",targetElement:v1(i),dragStart:function(H1){if(!i.getEnableAppointmentsResize()||j._isOneMonthIntervalOnSmallSizes()||!j._isResizingPerformed()){H1.preventDefault();return;}var I1=H1.getParameter("dragSession"),J1=j.$().find(".sapUiCalendarRowAppsOverlay"),K1=Q(I1.getIndicator()),L1=I1.getDragControl().$();K1.addClass("sapUiDnDIndicatorHide");setTimeout(function(){J1.addClass("sapUiCalendarRowAppsOverlayDragging");},0);Q(document).one("dragend",function(){J1.removeClass("sapUiCalendarRowAppsOverlayDragging");K1.removeClass("sapUiDnDIndicatorHide");L1.css({width:"auto","min-width":"auto","z-index":"auto",opacity:1});});if(!l.browser.msie&&!l.browser.edge){H1.getParameter("browserEvent").dataTransfer.setDragImage(r1(),0,0);}},dragEnter:function(H1){var I1=H1.getParameter("dragSession"),J1=this.getTargetElement(),K1=function(){var O1=Q(I1.getIndicator());O1.addClass("sapUiDnDIndicatorHide");},L1=I1.getDropControl().getDomRef().getBoundingClientRect(),M1=sap.ui.getCore().byId(J1).getDomRef().getBoundingClientRect(),N1={width:L1.left+L1.width-(I1.getDragControl().$().position().left+M1.left),"min-width":Math.min(I1.getDragControl().$().outerWidth(),I1.getDropControl().$().outerWidth()),"z-index":1,opacity:0.8};I1.getDragControl().$().css(N1);if(!I1.getIndicator()){setTimeout(K1,0);}else{K1();}},drop:function(H1){var j=v1(i),I1=H1.getParameter("dragSession"),J1=I1.getDragControl(),K1=j.getIntervalType(),L1=j.getStartDate(),M1=j.indexOfAggregation("_intervalPlaceholders",I1.getDropControl()),N1;if(K1===V.Hour){N1=this._calcResizeNewHoursAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}else if(K1===V.Day||K1===V.Week||(K1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){N1=this._calcResizeNewDaysAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}else if(K1===V.Month){N1=this._calcResizeNewMonthsAppPos(L1,J1.getStartDate(),J1.getEndDate(),M1);}j.$().find(".sapUiCalendarRowAppsOverlay").removeClass("sapUiCalendarRowAppsOverlayDragging");Q(I1.getIndicator()).removeClass("sapUiDnDIndicatorHide");J1.$().css({width:"auto","min-width":"auto","z-index":"auto",opacity:1});if(J1.getEndDate().getTime()===N1.endDate.getTime()){return;}i.fireAppointmentResize({appointment:J1,startDate:N1.startDate,endDate:N1.endDate,calendarRow:i});}.bind(this)});G1.setProperty("groupName",X);return G1;};$.prototype._calcResizeNewHoursAppPos=function(i,j,G1,H1){var I1=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours()),J1=30*60*1000;I1=new Date(I1.getTime()+((H1+1)*J1));if(I1.getTime()<=j.getTime()){I1=new Date(j.getTime()+J1);}return{startDate:j,endDate:I1};};$.prototype._calcResizeNewDaysAppPos=function(i,j,G1,H1){var I1=new Date(i),J1=I1.getDate()+H1+1;if(J1<=j.getDate()){J1=j.getDate()+1;}I1.setDate(J1);I1=new Date(I1.getFullYear(),I1.getMonth(),I1.getDate());return{startDate:j,endDate:I1};};$.prototype._calcResizeNewMonthsAppPos=function(i,j,G1,H1){var I1=new Date(i),J1=I1.getMonth()+H1+1;if(J1<=j.getMonth()){J1=j.getMonth()+1;}I1.setMonth(J1);I1=new Date(I1.getFullYear(),I1.getMonth(),1);return{startDate:j,endDate:I1};};$.prototype._calcCreateNewAppHours=function(i,j,G1){var H1=30*60*1000,I1,J1;if(j<=G1){I1=new Date(i.getTime()+(j*H1));J1=new Date(i.getTime()+((G1+1)*H1));}else{I1=new Date(i.getTime()+(G1*H1));J1=new Date(i.getTime()+(j*H1));}return{startDate:I1,endDate:J1};};$.prototype._calcCreateNewAppDays=function(i,j,G1){var H1=new Date(i),I1=new Date(i);if(j<=G1){H1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+j);I1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+G1+1);}else{H1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+G1);I1=new Date(i.getFullYear(),i.getMonth(),i.getDate()+j);}return{startDate:H1,endDate:I1};};$.prototype._calcCreateNewAppMonths=function(i,j,G1){var H1=new Date(i),I1=new Date(i);if(j<=G1){H1=new Date(i.getFullYear(),i.getMonth()+j,1);I1=new Date(i.getFullYear(),i.getMonth()+G1+1,1);}else{H1=new Date(i.getFullYear(),i.getMonth()+G1,1);I1=new Date(i.getFullYear(),i.getMonth()+j,1);}return{startDate:H1,endDate:I1};};$.prototype._getConfigFromDragDropConfigAggregation=function(j,G1){var H1=j,I1=H1&&H1.length;for(var i=0;i<I1;i++){if(H1[i].getGroupName()===G1){return H1[i];}}return null;};$.prototype._getAppointmentsCreateConfig=function(i){var j=v1(i),G1=new p({targetAggregation:"_intervalPlaceholders",dragStart:function(H1){if(!i.getEnableAppointmentsCreate()||j._isOneMonthIntervalOnSmallSizes()||!j._isCreatingPerformed()){H1.preventDefault();return;}var I1=H1.getParameter("dragSession"),J1=j.$().find(".sapUiCalendarRowAppsOverlay"),K1=Q(I1.getIndicator());setTimeout(function(){J1.addClass("sapUiCalendarRowAppsOverlayDragging");},0);Q(document).one("dragend",function(){J1.removeClass("sapUiCalendarRowAppsOverlayDragging");K1.html("");K1.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate");});if(!l.browser.msie&&!l.browser.edge){H1.getParameter("browserEvent").dataTransfer.setDragImage(r1(),0,0);}},dragEnter:function(H1){var I1=H1.getParameter("dragSession"),J1=I1.getDropControl().getDomRef().getBoundingClientRect(),K1=function(){var M1=Q(I1.getIndicator());M1.addClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate");};var L1=I1.getData("text")?parseFloat(I1.getData("text").split("|")[0]):0;if(L1){if(L1<=J1.left){I1.setIndicatorConfig({left:L1,width:Math.max((J1.left+J1.width-L1),J1.width)});}else{I1.setIndicatorConfig({left:J1.left,width:L1-J1.left});}}else{I1.setData("text",J1.left+"|"+j.indexOfAggregation("_intervalPlaceholders",I1.getDropControl()));}if(!I1.getIndicator()){setTimeout(K1,0);}else{K1();}},drop:function(H1){var I1=H1.getParameter("dragSession"),J1=Q(I1.getIndicator()),K1=j.getIntervalType(),L1=v1(i).getStartDate(),M1=parseInt(I1.getData("text").split("|")[1]),N1=j.indexOfAggregation("_intervalPlaceholders",I1.getDropControl()),O1;if(K1===V.Hour){O1=this._calcCreateNewAppHours(L1,M1,N1);}else if(K1===V.Day||K1===V.Week||(K1===V.OneMonth&&!j._isOneMonthIntervalOnSmallSizes())){O1=this._calcCreateNewAppDays(L1,M1,N1);}else if(K1===V.Month){O1=this._calcCreateNewAppMonths(L1,M1,N1);}i.fireAppointmentCreate({startDate:O1.startDate,endDate:O1.endDate,calendarRow:i});J1.html("");J1.removeClass("sapUiCalendarApp sapUiCalendarAppType01 sapUiAppCreate");}.bind(this)});G1.setProperty("groupName",Y);return G1;};function r1(){var i=Q("<span></span>").addClass("sapUiCalAppResizeGhost");i.appendTo(document.body);setTimeout(function(){i.remove();},0);return i.get(0);}function s1(i){var j=i.getId();return sap.ui.getCore().byId(j.substring(0,j.indexOf(Z)));}function t1(i){return sap.ui.getCore().byId(i.getId()+Z);}function u1(i){var j=t1(i);return j?j.getHeader():null;}function v1(i){var j=t1(i);return j?j.getTimeline():null;}function w1(j){var G1=[];var H1=this.getRows();for(var i=0;i<H1.length;i++){var I1=H1[i];var J1=t1(I1);var K1=J1.getSelected();if(I1.getSelected()!=K1){I1.setProperty("selected",K1,true);G1.push(I1);}}if(!this.getSingleSelection()){C1.call(this);}if(G1.length>0){this.fireRowSelectionChange({rows:G1});}}function x1(i){if(i<this._iBreakPointTablet){this._iSize=0;}else if(i<this._iBreakPointDesktop){this._iSize=1;}else{this._iSize=2;}if(i<d1.PHONE){this._iSizeScreen=0;}else if(i<d1.TABLET){this._iSizeScreen=1;}else{this._iSizeScreen=2;}}function y1(j){var G1='sapMSize'+j,H1=this.$(),i,I1;if(H1){for(i=0;i<3;i++){I1='sapMSize'+i;if(I1===G1){H1.addClass(I1);}else{H1.removeClass(I1);}}}}function z1(){var j=this._getViews();this._oIntervalTypeSelect.destroyItems();var i;var G1;for(i=0;i<j.length;i++){var H1=j[i];G1=new I(this.getId()+"-"+i,{key:H1.getKey(),text:H1.getDescription(),tooltip:H1.getTooltip()});this._oIntervalTypeSelect.addItem(G1);}this._oIntervalTypeSelect.setVisible(!(j.length===1));}function A1(i){var j=i.getParameter("selected");var G1=this.getRows();if(j){G1=this.getRows().filter(function(H1){return!H1.getSelected();});}this.selectAllRows(j);this.fireRowSelectionChange({rows:G1});}function B1(j){var G1=j.oSource;var H1=j.getParameter("type");var I1=this.getRows();var J1;var K1;var L1;var M1;var i=0;var N1=0;var O1;for(i=0;i<I1.length;i++){J1=I1[i];if(v1(J1)==G1){N1=i;break;}}switch(H1){case"sapup":L1=G1.getFocusedAppointment();M1=L1.getStartDate();if(N1>0){N1--;}K1=I1[N1];v1(K1).focusNearestAppointment(M1);break;case"sapdown":L1=G1.getFocusedAppointment();M1=L1.getStartDate();if(N1<I1.length-1){N1++;}K1=I1[N1];v1(K1).focusNearestAppointment(M1);break;case"saphome":if(N1>0){K1=I1[0];O1=new Q.Event(H1);O1._bPlanningCalendar=true;v1(K1).onsaphome(O1);}break;case"sapend":if(N1<I1.length-1){K1=I1[I1.length-1];O1=new Q.Event(H1);O1._bPlanningCalendar=true;v1(K1).onsapend(O1);}break;default:break;}}function C1(){if(this._oSelectAllCheckBox){var i=this.getRows();var j=this.getSelectedRows();if(i.length==j.length&&j.length>0){this._oSelectAllCheckBox.setSelected(true);}else{this._oSelectAllCheckBox.setSelected(false);}}}function D1(){if(this.getSingleSelection()){if(this._oCalendarHeader.getAllCheckBox()){this._oCalendarHeader.setAllCheckBox();}else if(this._oInfoToolbar.getContent().length>2){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox);}}else{if(!this._oSelectAllCheckBox){this._oSelectAllCheckBox=new sap.m.CheckBox(this.getId()+"-All",{text:this._oRB.getText("COLUMNSPANEL_SELECT_ALL")});this._oSelectAllCheckBox.attachEvent("select",A1,this);}if(this._iSizeScreen<2||!this.getShowRowHeaders()){var i=this._oInfoToolbar.indexOfContent(this._oSelectAllCheckBox);if(this._iSizeScreen<2){if(i<this._oInfoToolbar.getContent().length-1){this._oInfoToolbar.addContent(this._oSelectAllCheckBox);}}else if(i<0||i>1){if(i>1){this._oInfoToolbar.removeContent(this._oSelectAllCheckBox);}this._oInfoToolbar.insertContent(this._oSelectAllCheckBox,1);}}else{this._oCalendarHeader.setAllCheckBox(this._oSelectAllCheckBox);}}}function E1(){var i=this.getAggregation("table");var j=i.getMode();var G1;if(this.getSingleSelection()){if(!this.getShowRowHeaders()&&this.getRows().length==1){G1=F.None;}else{G1=F.SingleSelectMaster;}}else{G1=F.MultiSelect;}if(j!=G1){i.setMode(G1);}}function F1(){return this._oTimeInterval||this._oDateInterval||this._oMonthInterval||this._oWeekInterval||this._oOneMonthInterval;}return $;});
