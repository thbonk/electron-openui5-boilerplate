/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./Popover','./PopoverRenderer','./OverflowToolbarAssociativePopoverControls','./OverflowToolbarLayoutData'],function(P,a,O,b){"use strict";var c=P.extend("sap.m._overflowToolbarHelpers.OverflowToolbarAssociativePopover",{metadata:{associations:{associatedContent:{type:"sap.ui.core.Control",multiple:true}}},renderer:a.render});c.prototype.init=function(){P.prototype.init.apply(this,arguments);this.oControlsManager=new O();};c.prototype.onBeforeRendering=function(){P.prototype.onBeforeRendering.apply(this,arguments);this.addStyleClass("sapMOTAPopover");var h=this._getAllContent().some(function(o){return o.hasStyleClass("sapMOTAPButtonWithIcon");});if(h){this.addStyleClass("sapMOTAPButtonsWithIcons");}else{this.removeStyleClass("sapMOTAPButtonsWithIcons");}};c.prototype.addAssociatedContent=function(o){this.addAssociation("associatedContent",o,true);this._preProcessControl(o);return this;};c.prototype.removeAssociatedContent=function(o){var r=this.removeAssociation("associatedContent",o,true),d;if(r){d=sap.ui.getCore().byId(r);if(d){this._postProcessControl(d);}}return r;};c.prototype._preProcessControl=function(o){var s=O.getControlClass(o),d=O.getControlConfig(o),A,p;d.listenForEvents.forEach(function(e){A="attach"+C(e);if(o[A]){o[A](this._closeOnInteraction.bind(this,o));}else{o.attachEvent(e,this._closeOnInteraction.bind(this,o));}},this);p="_preProcess"+s.split(".").map(C).join("");if(typeof this.oControlsManager[p]==="function"){this.oControlsManager[p](o);}var l=o.getLayoutData();if(l instanceof b&&l.getPriority()===sap.m.OverflowToolbarPriority.Disappear){o.addStyleClass("sapMOTAPHidden");}return this;};c.prototype._postProcessControl=function(o){var s=O.getControlClass(o),d=O.getControlConfig(o),D,p;d.listenForEvents.forEach(function(e){D="detach"+C(e);if(o[D]){o[D](this._closeOnInteraction,this);}else{o.detachEvent(e,this._closeOnInteraction,this);}},this);p="_postProcess"+s.split(".").map(C).join("");if(typeof this.oControlsManager[p]==="function"){this.oControlsManager[p](o);}o.removeStyleClass("sapMOTAPHidden");o.$().remove();return this;};c.prototype._closeOnInteraction=function(o){var l=o.getLayoutData();if(!l||!(l instanceof b)||l.getCloseOverflowOnInteraction()){this.close();}};c.prototype._getContentIdsHash=function(){return this._getAllContent().join(".");};c.prototype._recalculateMargins=function(s,p){if(s!==sap.m.PlacementType.Top){return P.prototype._recalculateMargins.apply(this,arguments);}p._fMarginBottom=p._fDocumentHeight-p._$parent.offset().top+this._arrowOffset+p._fOffsetY;};c.prototype._getAllContent=function(){var A=this.getAssociatedContent().map(function(i){return sap.ui.getCore().byId(i);});if(this.getPlacement()===sap.m.PlacementType.Top){A.reverse();}return this.getContent().concat(A);};c.prototype.getCurrentPosition=function(){if(!this._oCalcedPos){this._calcPlacement();}return this._oCalcedPos;};function C(n){return n.substring(0,1).toUpperCase()+n.substring(1);}return c;},false);
