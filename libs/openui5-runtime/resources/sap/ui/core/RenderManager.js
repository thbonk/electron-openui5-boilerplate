/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./LabelEnablement','sap/ui/base/Object','sap/ui/dom/patch','sap/ui/performance/trace/Interaction','sap/base/util/uid',"sap/ui/util/ActivityDetection","sap/ui/thirdparty/jquery","sap/base/security/encodeXML","sap/base/assert","sap/ui/performance/Measurement","sap/base/Log"],function(L,B,d,I,u,A,q,a,b,M,c){"use strict";var C=["renderControl","translate","getConfiguration","getHTML","cleanupControlWithoutRendering"];var s=["write","writeEscaped","writeAcceleratorKey","writeControlData","writeInvisiblePlaceholderData","writeElementData","writeAttribute","writeAttributeEscaped","addClass","writeClasses","addStyle","writeStyles","writeAccessibilityState","writeIcon"];var D=["openStart","openEnd","close","voidStart","voidEnd","text","attr","class","style","controlData","elementData","accessibilityState","invisiblePlaceholderData","icon","unsafeHtml"];var N=["render","flush","destroy"];var f=((window["sap-ui-config"]&&window["sap-ui-config"]["xx-debugRendering"])||/sap-ui-xx-debug(R|-r)endering=(true|x|X)/.test(document.location.search));function R(){var l=this,F,p,v,S,x,G;this._setFocusHandler=function(n){b(n&&B.isA(n,'sap.ui.core.FocusHandler'),"oFocusHandler must be an sap.ui.core.FocusHandler");F=n;};function H(){p=l.aBuffer=[];v=l.aRenderedControls=[];S=l.aStyleStack=[{}];}this.write=function(e){b((typeof e==="string")||(typeof e==="number"),"sText must be a string or number");p.push.apply(p,arguments);return this;};this.writeEscaped=function(e,i){if(e!=null){e=a(String(e));if(i){e=e.replace(/&#xa;/g,"<br>");}p.push(e);}return this;};this.writeAttribute=function(n,e){b(typeof n==="string","sName must be a string");b(typeof e==="string"||typeof e==="number"||typeof e==="boolean","value must be a string, number or boolean");p.push(" ",n,"=\"",e,"\"");return this;};this.writeAttributeEscaped=function(n,e){b(typeof n==="string","sName must be a string");p.push(" ",n,"=\"",a(String(e)),"\"");return this;};this.addStyle=function(n,e){b(typeof n==="string","sName must be a string");if(e!=null){b((typeof e==="string"||typeof e==="number"),"value must be a string or number");var i=S[S.length-1];if(!i.aStyle){i.aStyle=[];}i.aStyle.push(n+":"+e);}return this;};this.writeStyles=function(){var e=S[S.length-1];if(e.aStyle){this.write(" style=\""+e.aStyle.join(";")+"\" ");}e.aStyle=null;return this;};this.addClass=function(n){if(n){b(typeof n==="string","sName must be a string");var e=S[S.length-1];if(!e.aClasses){e.aClasses=[];}e.aClasses.push(n);}return this;};this.writeClasses=function(e){b(!e||typeof e==="boolean"||B.isA(e,'sap.ui.core.Element'),"oElement must be empty, a boolean, or an sap.ui.core.Element");var j=S[S.length-1];var X;if(e){X=e.aCustomStyleClasses;}else if(e===false){X=[];}else{X=j.aCustomStyleClasses;}if(j.aClasses||X){var Y=[].concat(j.aClasses||[],X||[]);Y.sort();Y=Y.filter(function(n,i){return i==0||n!==Y[i-1];});this.write(" class=\"",Y.join(" "),"\" ");}if(!e){j.aCustomStyleClasses=null;}j.aClasses=null;return this;};var J=false;var K=false;this.openStart=function(e){b(!J,"New must not be opened when last opened tag not yet closed with 'openEnd'");J=true;this.write("<"+e+" ");return this;};this.openEnd=function(){J=false;this.writeClasses();this.writeStyles();this.write(">");return this;};this.close=function(e){this.write("</"+e+">");return this;};this.voidStart=function(e){K=true;this.openStart(e);return this;};this.voidEnd=function(){b(K,"Closing a self-closing tag via 'voidEnd' must be preceded by a 'voidStart'");K=false;this.write("/");this.openEnd();return this;};this.unsafeHtml=function(e){b(!J,"HTML can only be written when there's no tag open");this.write(e);return this;};this.text=function(e){b(!J,"text can only be written when there's no tag open");this.writeEscaped(e);return this;};this.controlData=function(e){b(J,"controlData can only be written when an opening tag has been started");this.writeControlData(e);return this;};this.elementData=function(e){b(J,"elementData can only be written when an opening tag has been started");this.writeElementData(e);return this;};this.attr=function(e,i){b(e!=='class'&&e!=='style',"attributes 'class' and 'style' must not be written, use methods 'class' and 'style' instead");this.writeAttributeEscaped(e,i);return this;};this.class=function(e){b(typeof e==="string"&&!/\s/.test(e)&&arguments.length===1,"method class must be called with exactly one class name");for(var i=0;i<arguments.length;i++){this.addClass(arguments[i]);}return this;};this.style=function(e,i){b(typeof e==="string"&&e&&!/\s/.test(e),"method style must be called with a non-empty string name");this.addStyle(e,i);return this;};this.accessibilityState=this.writeAccessibilityState;this.invisiblePlaceholderData=this.writeInvisiblePlaceholderData;this.icon=this.writeIcon;function O(e){G=true;try{var i=q.Event("BeforeRendering");i.srcControl=e;e._handleEvent(i);}finally{G=false;}}this.cleanupControlWithoutRendering=function(e){b(!e||B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control or empty");if(!e||!e.getDomRef()){return;}O(e);e.bOutput=false;};this.renderControl=function(e){b(!e||B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control or empty");if(!e){return this;}if(!x){x=[];}if(x&&x.length>0){M.pause(x[0]+"---renderControl");}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){M.pause(e.getParent().getId()+"---rerender");}x.unshift(e.getId());M.start(e.getId()+"---renderControl","Rendering of "+e.getMetadata().getName(),["rendering","control"]);var j=p.length;var n={};if(e.aCustomStyleClasses&&e.aCustomStyleClasses.length>0){n.aCustomStyleClasses=e.aCustomStyleClasses;}S.push(n);M.pause(e.getId()+"---renderControl");var X;var Y=e.getMetadata();var Z=e.getVisible();if(Z){X=Y.getRenderer();}else{var $=Y.getProperty("visible");var _=$&&$._oParent&&$._oParent.getName()=="sap.ui.core.Control";X=_?E:Y.getRenderer();}M.resume(e.getId()+"---renderControl");O(e);var a1=e.aBindParameters;if(a1&&a1.length>0){var b1=q(e.getDomRef());if(b1&&b1[0]){for(var i=0;i<a1.length;i++){var c1=a1[i];b1.unbind(c1.sEventType,c1.fnProxy);}}}if(X&&typeof X.render==="function"){var d1=V;X.render(d1,e);}else{c.error("The renderer for class "+Y.getName()+" is not defined or does not define a render function! Rendering of "+e.getId()+" will be skipped!");}S.pop();v.push(e);if(e.getUIArea&&e.getUIArea()){e.getUIArea()._onControlRendered(e);}e.bOutput=p.length!=j;if(X===E){e.bOutput="invisible";}M.end(e.getId()+"---renderControl");x.shift();if(x&&x.length>0){M.resume(x[0]+"---renderControl");}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){M.resume(e.getParent().getId()+"---rerender");}return this;};this.getHTML=function(e){b(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");var i=p;var j=p=this.aBuffer=[];this.renderControl(e);p=this.aBuffer=i;return j.join("");};function Q(n){var i,X=v.length;for(i=0;i<X;i++){v[i]._sapui_bInAfterRenderingPhase=true;}G=true;try{for(i=0;i<X;i++){var Y=v[i];if(Y.bOutput&&Y.bOutput!=="invisible"){var Z=q.Event("AfterRendering");Z.srcControl=Y;M.start(Y.getId()+"---AfterRendering","AfterRendering of "+Y.getMetadata().getName(),["rendering","after"]);Y._handleEvent(Z);M.end(Y.getId()+"---AfterRendering");}}}finally{for(i=0;i<X;i++){delete v[i]._sapui_bInAfterRenderingPhase;}G=false;}try{F.restoreFocus(n);}catch(e){c.warning("Problems while restoring the focus after rendering: "+e,null);}for(i=0;i<X;i++){var Y=v[i],$=Y.aBindParameters;if($&&$.length>0){var _=q(Y.getDomRef());if(_&&_[0]){for(var j=0;j<$.length;j++){var a1=$[j];_.bind(a1.sEventType,a1.fnProxy);}}}}}function T(e){var i=F?F.getControlFocusInfo():null;var j=p.join("");e(j);Q(i);H();A.refresh();I.notifyStepEnd();}this.flush=function(e,j,n){b((typeof e==="object")&&(e.ownerDocument==document),"oTargetDomNode must be a DOM element");if(!j&&(typeof n!=="number")&&!n){R.preserveContent(e);}T(function(X){for(var i=0;i<v.length;i++){var Y=v[i].getDomRef();if(Y&&!R.isPreservedContent(Y)){if(R.isInlineTemplate(Y)){q(Y).empty();}else{q(Y).remove();}}}if(typeof n==="number"){if(n<=0){q(e).prepend(X);}else{var $=q(e).children().eq(n-1);if($.length===1){$.after(X);}else{q(e).append(X);}}}else if(!n){q(e).html(X);}else{q(e).append(X);}});};this.render=function(e,i){b(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be a control");b(typeof i==="object"&&i.ownerDocument==document,"oTargetDomNode must be a DOM element");if(G){c.error("Render must not be called within Before or After Rendering Phase. Call ignored.",null,this);return;}H();this.renderControl(e);T(function(j){if(e&&i){var n=e.getDomRef();if(!n||R.isPreservedContent(n)){n=((g.Invisible+e.getId()?window.document.getElementById(g.Invisible+e.getId()):null))||((g.Dummy+e.getId()?window.document.getElementById(g.Dummy+e.getId()):null));}var X=n&&n.parentNode!=i;var Y=function(){var $=q(i);if(i.innerHTML==""){$.html(j);}else{$.append(j);}};if(X){if(!R.isPreservedContent(n)){if(R.isInlineTemplate(n)){q(n).empty();}else{q(n).remove();}}if(j){Y();}}else{if(j){if(n){if(R.isInlineTemplate(n)){q(n).html(j);}else if(z()){var Z=q.parseHTML(j)[0];q.cleanData([n]);q.cleanData(n.getElementsByTagName("*"));d(n,Z);}else{q(n).replaceWith(j);}}else{Y();}}else{if(R.isInlineTemplate(n)){q(n).empty();}else{if(!e.getParent()||!e.getParent()._onChildRerenderedEmpty||!e.getParent()._onChildRerenderedEmpty(e,n)){q(n).remove();}}}}}});};this.destroy=function(){H();};var U={};var V={};var W={};C.forEach(function(e){U[e]=V[e]=W[e]=l[e];});D.forEach(function(e){V[e]=W[e]=l[e];});s.forEach(function(e){U[e]=W[e]=l[e];if(f){V[e]=function(){c.error("**** calling legacy render method "+e);return l[e].apply(this,arguments);};}else{V[e]=l[e];}});N.forEach(function(e){W[e]=l[e];});this.getRendererInterface=function(){return V;};this.getInterface=function(){return W;};H();}R.prototype.getConfiguration=function(){return sap.ui.getCore().getConfiguration();};R.prototype.translate=function(K){};R.prototype.writeAcceleratorKey=function(){return this;};R.prototype.writeControlData=function(e){b(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");this.writeElementData(e);return this;};R.prototype.writeInvisiblePlaceholderData=function(e){b(B.isA(e,'sap.ui.core.Element'),"oElement must be an instance of sap.ui.core.Element");var p=R.createInvisiblePlaceholderId(e),i=' '+'id="'+p+'" '+'class="sapUiHiddenPlaceholder" '+'data-sap-ui="'+p+'" '+'style="display: none;"'+'aria-hidden="true" ';this.write(i);return this;};R.prototype.writeElementData=function(e){b(e&&B.isA(e,'sap.ui.core.Element'),"oElement must be an sap.ui.core.Element");var j=e.getId();if(j){this.attr("id",j);this.attr("data-sap-ui",j);}var n=e.getCustomData();var l=n.length;for(var i=0;i<l;i++){var p=n[i]._checkWriteToDom(e);if(p){this.attr(p.key,p.value);}}var v=e.getDragDropConfig().some(function(F){return F.isDraggable(e);});if(!v){var x=e.getParent();if(x&&x.getDragDropConfig){v=x.getDragDropConfig().some(function(F){return F.isDraggable(e);});}}if(v){this.attr("draggable","true");this.attr("data-sap-ui-draggable","true");}return this;};R.prototype.writeAccessibilityState=function(e,j){if(!sap.ui.getCore().getConfiguration().getAccessibility()){return this;}if(arguments.length==1&&!(B.isA(e,'sap.ui.core.Element'))){j=e;e=null;}var l={};if(e!=null){var n=e.getMetadata();var F=function(i,v,V){var Q=n.getProperty(i);if(Q&&e[Q._sGetter]()===V){l[v]="true";}};var G=function(v,Q){var S=n.getAssociation(v);if(S&&S.multiple){var T=e[S._sGetter]();if(v=="ariaLabelledBy"){var U=L.getReferencingLabels(e);var V=U.length;if(V){var W=[];for(var i=0;i<V;i++){if(T.indexOf(U[i])<0){W.push(U[i]);}}T=W.concat(T);}}if(T.length>0){l[Q]=T.join(" ");}}};F("editable","readonly",false);F("enabled","disabled",false);F("visible","hidden",false);if(L.isRequired(e)){l["required"]="true";}F("selected","selected",true);F("checked","checked",true);G("ariaDescribedBy","describedby");G("ariaLabelledBy","labelledby");}if(j){var H=function(v){var i=typeof(v);return v===null||v===""||i==="number"||i==="string"||i==="boolean";};var J={};var x,K,O;for(x in j){K=j[x];if(H(K)){J[x]=K;}else if(typeof(K)==="object"&&H(K.value)){O="";if(K.append&&(x==="describedby"||x==="labelledby")){O=l[x]?l[x]+" ":"";}J[x]=O+K.value;}}q.extend(l,J);}if(B.isA(e,'sap.ui.core.Element')&&e.getParent()&&e.getParent().enhanceAccessibilityState){e.getParent().enhanceAccessibilityState(e,l);}for(var p in l){if(l[p]!=null&&l[p]!==""){this.attr(p==="role"?p:"aria-"+p,l[p]);}}return this;};R.prototype.writeIcon=function(U,e,i){var j=sap.ui.requireSync("sap/ui/core/IconPool"),l=j.isIconURI(U),S=l?"span":"img",n=false,p,v,x,F,G;var H=this;if(typeof e==="string"){e=[e];}if(l){v=j.getIconInfo(U);if(!v){c.error("An unregistered icon: "+U+" is used in sap.ui.core.RenderManager's writeIcon method.");return this;}if(!e){e=[];}e.push("sapUiIcon");if(!v.suppressMirroring){e.push("sapUiIconMirrorInRTL");}}this.openStart(S);if(Array.isArray(e)&&e.length){e.forEach(function(J){H.class(J);});}if(l){x={"data-sap-ui-icon-content":v.content,"role":"presentation","title":v.text||null};this.style("font-family","'"+a(v.fontFamily)+"'");}else{x={role:"presentation",alt:"",src:U};}i=q.extend(x,i);if(!i.id){i.id=u();}if(l){F=i.alt||i.title||v.text||v.name;G=i.id+"-label";if(i["aria-labelledby"]){n=true;i["aria-labelledby"]+=(" "+G);}else if(!i.hasOwnProperty("aria-label")){i["aria-label"]=F;}}if(typeof i==="object"){for(p in i){if(i.hasOwnProperty(p)&&i[p]!==null){this.attr(p,i[p]);}}}if(l){this.openEnd(S);if(n){this.openStart("span");this.style("display","none");this.attr("id",G);this.openEnd("span");this.text(F);this.close("span");}this.close("span");}else{this.openEnd();}return this;};R.prototype.getRenderer=function(e){b(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");return R.getRenderer(e);};var g=R.RenderPrefixes={Invisible:"sap-ui-invisible-",Dummy:"sap-ui-dummy-",Temporary:"sap-ui-tmp-"};R.getRenderer=function(e){b(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");return e.getMetadata().getRenderer();};R.forceRepaint=function(v){var e=v?window.document.getElementById(v):null;var i=typeof v=="string"?e:v;if(i){c.debug("forcing a repaint for "+(i.id||String(i)));var O=i.style.display;var j=document.activeElement;i.style.display="none";i.offsetHeight;i.style.display=O;if(document.activeElement!==j&&j){j.focus();}}};R.createInvisiblePlaceholderId=function(e){return g.Invisible+e.getId();};var h="sap-ui-preserve",k="sap-ui-static",m="data-sap-ui-preserve",o="data-sap-ui-area";function r(){var $=q(document.getElementById(h));if($.length===0){$=q("<DIV/>",{"aria-hidden":"true",id:h}).addClass("sapUiHidden").addClass("sapUiForcedHidden").css("width","0").css("height","0").css("overflow","hidden").appendTo(document.body);}return $;}function t(n){q("<DIV/>",{id:g.Dummy+n.id}).addClass("sapUiHidden").insertBefore(n);}var P=[];R.attachPreserveContent=function(l,e){R.detachPreserveContent(l);P.push({fn:l,context:e});};R.detachPreserveContent=function(l){P=P.filter(function(e){return e.fn!==l;});};R.preserveContent=function(e,p,j){b(typeof e==="object"&&e.ownerDocument==document,"oRootNode must be a DOM element");P.forEach(function(i){i.fn.call(i.context||R,{domNode:e});});var $=r();function n(i){while(i&&i!=e&&i.parentNode){i=i.parentNode;if(i.hasAttribute(m)){return true;}if(i.hasAttribute("data-sap-ui")){break;}}}function l(i){if(i.id===h||i.id===k){return;}if(i.hasAttribute(m)){if(i===e||n(i)){t(i);}$.append(i);}else if(j&&i.id){R.markPreservableContent(q(i),i.id);$.append(i);return;}if(!i.hasAttribute(o)){var v=i.firstChild;while(v){i=v;v=v.nextSibling;if(i.nodeType===1){l(i);}}}}M.start(e.id+"---preserveContent","preserveContent for "+e.id,["rendering","preserve"]);if(p){l(e);}else{q(e).children().each(function(i,v){l(v);});}M.end(e.id+"---preserveContent");};R.findPreservedContent=function(i){b(typeof i==="string","sId must be a string");var $=r(),e=$.children("["+m+"='"+i.replace(/(:|\.)/g,'\\$1')+"']");return e;};R.markPreservableContent=function($,i){$.attr(m,i);};R.isPreservedContent=function(e){return(e&&e.getAttribute(m)&&e.parentNode&&e.parentNode.id==h);};R.getPreserveAreaRef=function(){return r()[0];};var w="data-sap-ui-template";R.markInlineTemplate=function($){$.attr(w,"");};R.isInlineTemplate=function(e){return(e&&e.hasAttribute(w));};var y;function z(){if(y===undefined){y=sap.ui.getCore().getConfiguration().getDomPatching();if(y){c.warning("DOM Patching is enabled: This feature should be used only for testing purposes!");}}return y;}var E={render:function(e,i){e.openStart("span");e.invisiblePlaceholderData(i);e.openEnd();e.close("span");}};return R;},true);
