/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/ui/rta/appVariant/manageApps/webapp/model/models","sap/ui/rta/appVariant/Utils","sap/m/MessageBox"],function(q,C,M,a,b){"use strict";var _,m,I;return C.extend("sap.ui.rta.appVariant.manageApps.webapp.controller.ManageApps",{onInit:function(){_=this.getOwnerComponent().getAdaptedAppProperties();var o=_.componentName;m=q.sap.getModulePath("sap.ui.rta.appVariant.manageApps.webapp");I=q.sap.resources({url:m+"/i18n/i18n.properties"});var A=I.getText("MAA_APP_VARIANT_TYPE");return a.getAppVariants(o,A).then(function(c){return this._addAppVariantsProperties(c).then(function(){return this._paintCurrentlyAdaptedApp();}.bind(this));}.bind(this))["catch"](function(e){return this._showMessage(b.Icon.ERROR,"HEADER_MANAGE_APPS_FAILED","MSG_MANAGE_APPS_FAILED",e).then(function(){return this._closeManageAppsDialog();}.bind(this));}.bind(this));},_showMessage:function(o,t,s,e){var c=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");var d=c.getText(s,e?[e.message||e]:undefined);var T=c.getText(t);return new Promise(function(r){b.show(d,{icon:o,title:T,onClose:r});});},_addAppVariantsProperties:function(A){var o={title:_.title,subTitle:_.subTitle,description:_.description,icon:_.icon,id:_.idAppAdapted,componentName:_.componentName,currentStatus:I.getText("MAA_CURRENTLY_ADAPTING")};if(_.idAppAdapted===_.componentName){o.type=I.getText("MAA_ORIGINAL_TYPE");A.unshift(o);return this._bindModelData(A);}else{var f=A.filter(function(c){return c.id!==o.id;});o.type=I.getText("MAA_APP_VARIANT_TYPE");f.unshift(o);return a.getOriginalAppProperties(_.componentName,I.getText("MAA_ORIGINAL_TYPE")).then(function(O){f.unshift(O[0]);return this._bindModelData(f);}.bind(this));}},_bindModelData:function(A){var o={appVariants:A};var c=M.createModel(o);this.getView().setModel(c);return Promise.resolve(true);},_closeManageAppsDialog:function(){var o=sap.ui.getCore().byId("manageAppsDialog");o.oPopup.attachClosed(function(){o.destroy();return Promise.resolve(true);});o.close();},_paintCurrentlyAdaptedApp:function(){var t=this.getView().byId("Table1");q('.maaCurrentStatus,.maaSubTitle').css("font-size",'12px');function c(){var r=t.getVisibleRowCount();var d=t.getFirstVisibleRow();var e;for(var i=0;i<r;i++){e=t.getContextByIndex(d+i);if(e&&e.getProperty("currentStatus")===I.getText("MAA_CURRENTLY_ADAPTING")){var s=sap.ui.core.theming.Parameters.get("sapUiHighlight");t.getRows()[i].$().find("span").css({color:s});break;}}return Promise.resolve(true);}return c();}});});
