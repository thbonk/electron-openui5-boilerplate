/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/rta/plugin/additionalElements/AdditionalElementsPlugin','sap/ui/dt/OverlayRegistry'],function(A,O){"use strict";var E=A.extend("sap.ui.rta.plugin.EasyAdd",{metadata:{library:"sap.ui.rta",properties:{},associations:{},events:{}}});E.prototype.registerElementOverlay=function(o){this._oDelegate={"onAfterRendering":function(){var a=function(d,o,i){var C;if(d){C=o.getDesignTimeMetadata().getName().plural;}else{C=o.getDesignTimeMetadata().getAggregation("sections").childNames.plural();}this.showAvailableElements(d,[o],i,C);}.bind(this);var f=function(o,d,s,C,i){var e=function(h){var o=sap.ui.getCore().byId(h.getSource().getId().replace("-AddButton",""));a(s,o,i);h.cancelBubble();};var g=typeof C==="function"?C():C;this._addButton(o,e,d,g);}.bind(this);if(o.$().hasClass("sapUiRtaPersAdd")){var b=o.$().hasClass("sapUiRtaPersAdd")&&o.$().children(".sapUiRtaPersAddIconOuter").length<=0;var p=o.getElementInstance().getParent();var P=O.getOverlay(p);if(p.getMetadata().getName()==="sap.uxap.ObjectPageLayout"){if(P.$().hasClass("sapUiRtaPersAddTop")&&P.getAggregationOverlay("sections").$().children(".sapUiRtaPersAddIconOuter").length>-1){p.$("sectionsContainer").addClass("sapUiRtaPaddingTop");}}if(b){f(o,o.$(),true,o.getDesignTimeMetadata().getName().singular);}}else if(o.$().hasClass("sapUiRtaPersAddTop")){if(o.getAggregationOverlay("sections").$().children(".sapUiRtaPersAddIconOuter").length<=0){var $=o.getAggregationOverlay("sections").$();f(o,$,false,o.getDesignTimeMetadata().getAggregation("sections").childNames.singular,0);}}o.removeEventDelegate(this._oDelegate,this);}};var c=o.getElementInstance();if(c.getMetadata().getName()==="sap.uxap.ObjectPageSection"&&this.hasStableId(o)){o.addStyleClass("sapUiRtaPersAdd");c.addStyleClass("sapUiRtaMarginBottom");}else if(c.getMetadata().getName()==="sap.uxap.ObjectPageLayout"&&this.hasStableId(o)){o.addStyleClass("sapUiRtaPersAddTop");c.$("sectionsContainer").addClass("sapUiRtaPaddingTop");}o.addEventDelegate(this._oDelegate,this);A.prototype.registerElementOverlay.apply(this,arguments);};E.prototype.deregisterElementOverlay=function(o){var c=o.getElementInstance();if(o._oAddButton){o._oAddButton.destroy();}if(c.getMetadata().getName()==="sap.uxap.ObjectPageSection"){o.removeStyleClass("sapUiRtaPersAdd");c.removeStyleClass("sapUiRtaMarginBottom");o.removeEventDelegate(this._oDelegate,this);}else if(c.getMetadata().getName()==="sap.uxap.ObjectPageLayout"){o.removeStyleClass("sapUiRtaPersAddTop");c.$("sectionsContainer").removeClass("sapUiRtaPaddingTop");}};E.prototype._addButton=function(o,c,a,C){var i=o.getId()+"-AddButton";var h=jQuery("<div class='sapUiRtaPersAddIconOuter' draggable='true'> </div>");o._oAddButton=new sap.m.Button(i,{text:"Add "+C,icon:"sap-icon://add",press:c}).placeAt(h.get(0));a.append(h);h[0].addEventListener("mouseover",function(e){e.stopPropagation();var o=e.fromElement?sap.ui.getCore().byId(e.fromElement.id):null;if(o&&o.getMetadata().getName()==="sap.ui.dt.ElementOverlay"){var p=o.getParentElementOverlay();p.$().removeClass("sapUiRtaOverlayHover");}});h[0].addEventListener("mouseleave",function(e){e.stopPropagation();var o=e.toElement?sap.ui.getCore().byId(e.toElement.id):null;if(o&&o.getMetadata().getName()==="sap.ui.dt.ElementOverlay"){var p=o.getParentElementOverlay();if(p.getMovable()){p.$().addClass("sapUiRtaOverlayHover");}}});h[0].addEventListener("dragstart",function(e){e.stopPropagation();e.preventDefault();});};return E;},true);
