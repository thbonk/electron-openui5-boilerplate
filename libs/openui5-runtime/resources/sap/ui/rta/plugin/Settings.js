/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/rta/plugin/Plugin','sap/ui/rta/Utils'],function(P,U){"use strict";var S=P.extend("sap.ui.rta.plugin.Settings",{metadata:{library:"sap.ui.rta",properties:{commandStack:{type:"any"}},associations:{},events:{}}});S.prototype._isEditable=function(o){if(!U.getRelevantContainerDesigntimeMetadata(o)){return false;}var s=this._getSettingsAction(o);if(s&&s.handler){return this.hasStableId(o);}return false;};S.prototype._getUnsavedChanges=function(i,c){var e;var u=this.getCommandStack().getAllExecutedCommands().filter(function(C){e=C.getElementId();if(e===i&&c.indexOf(C.getChangeType())>=0){return true;}}).map(function(C){return C.getPreparedChange();});return u;};S.prototype._getSettingsAction=function(o){return o.getDesignTimeMetadata()?o.getDesignTimeMetadata().getAction("settings",o.getElementInstance()):null;};S.prototype.isSettingsAvailable=function(o){return this._isEditableByPlugin(o);};S.prototype.isSettingsEnabled=function(o){var a=this._getSettingsAction(o);if(!a){return false;}if(typeof a.isEnabled!=="undefined"){if(typeof a.isEnabled==="function"){return a.isEnabled(o.getElementInstance());}else{return a.isEnabled;}}return true;};S.prototype.handleSettings=function(s){var o;var e=s[0].getElementInstance();var p={getUnsavedChanges:this._getUnsavedChanges.bind(this),styleClass:U.getRtaStyleClassName()};return s[0].getDesignTimeMetadata().getAction("settings").handler(e,this._getUnsavedChanges.bind(this),p).then(function(c){c.forEach(function(C){o=this.getCommandFactory().getCommandFor(C.selectorControl,"settings",C.changeSpecificData);this.fireElementModified({"command":o});},this);}.bind(this))['catch'](function(E){if(E){throw E;}});};return S;},true);
