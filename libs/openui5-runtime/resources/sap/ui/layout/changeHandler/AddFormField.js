/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/ui/fl/changeHandler/Base","sap/ui/fl/changeHandler/ChangeHandlerMediator","sap/ui/thirdparty/jquery"],function(U,B,C,q){"use strict";var A={};A.applyChange=function(c,f,p){var o=c.getDefinition();var v=p.view;var i=o.content.newFieldIndex;var m=p.modifier;var P=c.getDependentControl("parentFormContainer",p);var a,b;var d=p.appComponent;var e=C.getChangeHandlerSettings({"scenario":"addODataFieldWithLabel","oDataServiceVersion":o.content&&o.content.oDataServiceVersion});var g=e&&e.content&&e.content.createFunction;var h=function(o){var n=o.content;var M=false;if(n){M=o.content.newFieldSelector&&(o.content.newFieldIndex!==undefined)&&o.content.bindingPath&&o.content.oDataServiceVersion&&g;}return n&&M;};if(h(o)){var j=o.content;var F=j.newFieldSelector;var s=q.extend({},j.newFieldSelector);s.id=s.id+"-field";var k=j.bindingPath;c.setRevertData({newFieldSelector:F});var l={"appComponent":p.appComponent,"view":p.view,"fieldSelector":s,"bindingPath":k};if(m.bySelector(F,d)){return B.markAsNotApplicable("Control to be created already exists:"+F);}a=g(m,l);b=m.createControl("sap.ui.layout.form.FormElement",d,v,F);m.insertAggregation(b,"label",a.label,0,v);m.insertAggregation(b,"fields",a.control,0,v);m.insertAggregation(P,"formElements",b,i,v);return true;}else{U.log.error("Change does not contain sufficient information to be applied or ChangeHandlerMediator could not be retrieved: ["+o.layer+"]"+o.namespace+"/"+o.fileName+"."+o.fileType);}};A.completeChangeContent=function(c,s,p){var a=p.appComponent;var o=c.getDefinition();if(!o.content){o.content={};}if(s.parentId){c.addDependentControl(s.parentId,"parentFormContainer",p);}else{throw new Error("oSpecificChangeInfo.parentId attribute required");}if(s.bindingPath){o.content.bindingPath=s.bindingPath;}else{throw new Error("oSpecificChangeInfo.bindingPath attribute required");}if(s.newControlId){o.content.newFieldSelector=p.modifier.getSelector(s.newControlId,a);}else{throw new Error("oSpecificChangeInfo.newControlId attribute required");}if(s.index===undefined){throw new Error("oSpecificChangeInfo.targetIndex attribute required");}else{o.content.newFieldIndex=s.index;}if(s.oDataServiceVersion===undefined){throw new Error("oSpecificChangeInfo.oDataServiceVersion attribute required");}else{o.content.oDataServiceVersion=s.oDataServiceVersion;}};A.revertChange=function(c,f,p){var a=p.appComponent;var v=p.view;var m=p.modifier;var F=c.getRevertData().newFieldSelector;var o=m.bySelector(F,a,v);m.removeAggregation(f,"formElements",o);m.destroy(o);c.resetRevertData();return true;};return A;},true);
