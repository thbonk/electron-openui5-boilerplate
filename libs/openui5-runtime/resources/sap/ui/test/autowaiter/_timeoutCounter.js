/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/test/_LogCollector","sap/ui/test/_ParameterValidator"],function($,_,a){"use strict";var l=$.sap.log.getLogger("sap.ui.test.autowaiter._timeoutCounter",_.DEFAULT_LEVEL_FOR_OPA_LOGGERS);var c=new a({errorPrefix:"sap.ui.test.autowaiter._timeoutCounter#extendConfig"});var t={};var b={maxDepth:3,maxDelay:1000};var C=0;function d(n){var s="set"+n;var e="clear"+n;var o=window[s];if(!o){return;}var O=window[e];window[s]=function(f,D){var W=function(){C=t[i]+1;delete t[i];try{f();}finally{C=0;}};if(D>=b.maxDelay){l.debug("Long-running timeout is ignored. Timeout delay "+D+" exceeds the limit of "+b.maxDelay);return o.apply(this,arguments);}var i=o.call(this,W,D);t[i]=C;return i;};window[e]=function(i){delete t[i];return O.apply(this,arguments);};}d("Timeout");d("Immediate");var p=0;function w(o){var O=Promise[o];Promise[o]=function(){var T=false;var i=setTimeout(function(){T=true;p--;},b.maxDelay);var f=function(){if(T){return;}p--;clearTimeout(i);};p++;var P=O.apply(this,arguments);P.then(f,f);return P;};}w("resolve");w("all");w("race");w("reject");return{hasPendingTimeouts:function(){var T=Object.keys(t);var n=T.filter(function(i){var I=t[i]>=b.maxDepth;if(I){l.debug("Deep-nested timeout with ID "+i+" is ignored. Timeout depth "+t[i]+" exceeds the limit of "+b.maxDepth);}return!I;}).length;var h=n>0;if(p>0){l.debug("There are "+p+" pending microtasks");return true;}if(h){l.debug("There are '"+n+"' open blocking Timeouts. And "+(T.length-n)+" non blocking timeouts");}return h;},extendConfig:function(o){c.validate({inputToValidate:o,validationInfo:{maxDepth:"numeric",maxDelay:"numeric"}});$.extend(b,o);}};},true);
