/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";var _=[];var a=[];var b=function(i){var e=sap.ui.getCore().byId(i.context.id),d="";if(i.context.id==="WEBPAGE"){d="sap.ui.core";}else if(e){d=e.getMetadata().getName();}return{severity:i.severity,name:i.rule.title,description:i.rule.description,resolution:i.rule.resolution,resolutionUrls:i.rule.resolutionurls,audiences:i.rule.audiences,categories:i.rule.categories,details:i.details,ruleLibName:i.rule.libName,ruleId:i.rule.id,context:{className:d,id:i.context.id}};};var I={addIssue:function(i){_.push(i);},walkIssues:function(C){_.forEach(C);},clearIssues:function(){_=[];},saveHistory:function(){a.push({issues:_.slice()});},getHistory:function(){return a.slice();},getConvertedHistory:function(){var t=this,i=t.getHistory(),d=[],e=null;i.forEach(function(r){e=t.groupIssues(t.convertToViewModel(r.issues));d.push({issues:e});});return d;},getIssuesModel:function(){var v=[];this.walkIssues(function(i){v.push(b(i));});return v;},getRulesViewModel:function(r,s,i){var d={},e=0,g={},l={},f={},h=q.extend(true,{},r),j=q.extend(true,{},i);for(g in h){d[g]=q.extend(true,{},h[g].ruleset._mRules);l=d[g];Object.defineProperty(l,'selected',{enumerable:false,configurable:true,writable:true,value:false});Object.defineProperty(l,'issueCount',{enumerable:false,configurable:true,writable:true,value:0});for(f in h[g].ruleset._mRules){l[f]=q.extend(true,[],l[f]);Object.defineProperty(l[f],'selected',{enumerable:false,configurable:true,writable:true,value:false});Object.defineProperty(l[f],'issueCount',{enumerable:false,configurable:true,writable:true,value:0});if(s[f]){l[f].selected=true;l.selected=true;}if(j[g]&&j[g][f]){l[f].push.apply(l[f],j[g][f]);e=j[g][f].length;l[f].issueCount=e;l.issueCount+=e;}}}return d;},getTreeTableViewModel:function(r){var i=0,d=0,t={},e;e=this.getRulesViewModel(r,[],[]);for(var l in e){t[i]={name:l,type:"lib",rules:[]};for(var f in e[l]){t[i][d]={name:e[l][f].title,description:e[l][f].description,id:e[l][f].id,audiences:e[l][f].audiences,categories:e[l][f].categories,minversion:e[l][f].minversion,resolution:e[l][f].resolution,title:e[l][f].title,libName:l};d++;}i++;}return t;},getIssuesViewModel:function(i){var t={},d=0,e=0,f=0;for(var l in i){t[d]={name:l,showAudiences:false,showCategories:false,type:"lib"};for(var r in i[l]){t[d][e]={name:i[l][r][0].name+" ("+i[l][r].length+" issues)",showAudiences:true,showCategories:true,categories:i[l][r][0].categories.join(", "),audiences:i[l][r][0].audiences.join(", "),issueCount:i[l][r].length,description:i[l][r][0].description,resolution:i[l][r][0].resolution,type:"rule",ruleLibName:i[l][r][0].ruleLibName,ruleId:i[l][r][0].ruleId,selected:i[l][r][0].selected,details:i[l][r][0].details,severity:i[l][r][0].severity};f+=i[l][r].length;e++;}t[d].name+=" ("+f+" issues)";t[d].issueCount=f;f=0;e=0;d++;}return t;},clearHistory:function(){a=[];},convertToViewModel:function(o){var v=[];for(var i=0;i<o.length;i++){v.push(b(o[i]));}return v;},groupIssues:function(o){var g={},d={};for(var i=0;i<o.length;i++){d=o[i];if(!g[d.ruleLibName]){g[d.ruleLibName]={};}if(!g[d.ruleLibName][d.ruleId]){g[d.ruleLibName][d.ruleId]=[];}g[d.ruleLibName][d.ruleId].push(d);}return g;},createIssueManagerFacade:function(r){return new c(r);}};var c=function(r){this.oRule=r;};c.prototype.addIssue=function(i){i.rule=this.oRule;if(!sap.ui.support.Severity[i.severity]){throw"The issue from rule "+this.oRule.title+" does not have proper severity defined. Allowed values can be found"+"in sap.ui.support.Severity";}if(!i.context||!i.context.id){throw"The issue from rule '"+this.oRule.title+"' should provide a context id.";}if(!i.details){throw"The issue from rule '"+this.oRule.title+"' should provide details for the generated issue.";}I.addIssue(i);};return I;},true);
