/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/support/supportRules/Storage","sap/ui/support/supportRules/Constants","sap/ui/support/supportRules/ui/models/SelectionUtils","sap/ui/support/supportRules/ui/models/SharedModel","sap/ui/core/util/File","sap/ui/thirdparty/jquery","sap/ui/support/library"],function(S,c,a,b,F,q,l){"use strict";var P={model:b,getSystemPresets:function(){var s=[],k;for(k in l.SystemPresets){s.push(l.SystemPresets[k]);}return s;},initializeSelectionPresets:function(s){if(this.model.getProperty("/persistingSettings")){var p=S.getSelectionPresets();if(p){this.model.setProperty("/selectionPresets",p);}}var d=this.model.getProperty("/selectionPresets"),L=0;this.getSystemPresets().forEach(function(e){var i=d.some(function(f){if(e.id===f.id){if(!f.isModified){var I=f.selected;f=q.extend({},e);f.selected=I;if(I){a.setSelectedRules(f.selections);}}return true;}});if(!i){var m={disableDelete:true,isSystemPreset:true};d.splice(L+1,0,q.extend(m,e));}L++;});var o=null;d.some(function(C){if(C.selected){o=C;return true;}});if(o.isMySelection){o.selections=s;}this.model.setProperty("/selectionPresetsCurrent",o);},syncCurrentSelectionPreset:function(s){var p=this.model.getProperty("/selectionPresetsCurrent");p.selections=s;if(!(p.isModified||p.isMySelection)){p.isModified=true;p.title=p.title+" *";}this.model.setProperty("/selectionPresetsCurrent",p);if(P.isPersistingAllowed()){P.persistSelectionPresets();}},exportSelectionsToFile:function(i,t,d,s){var r={id:i,title:t,description:d,dateExported:(new Date()).toISOString(),version:"1.0",selections:s};var e=JSON.stringify(r);F.save(e,c.RULE_SELECTION_EXPORT_FILE_NAME,'json','text/plain');},isValidSelectionImport:function(I){var d=true;if(!I.hasOwnProperty("title")){d=false;}if(!I.hasOwnProperty("selections")){d=false;}else if(!Array.isArray(I.selections)){d=false;}else{for(var i=0;i<I.selections.length;i++){var r=I.selections[i];if(!r.hasOwnProperty("ruleId")||!r.hasOwnProperty("libName")){d=false;break;}}}return d;},persistSelectionPresets:function(){S.setSelectionPresets(this.model.getProperty("/selectionPresets"));},persistCustomPresets:function(){S.setCustomPresets(this.model.getProperty("/customPresets"));},isPersistingAllowed:function(){return!!S.readPersistenceCookie(c.COOKIE_NAME);},loadCustomPresets:function(){var p=S.getCustomPresets();if(p){this.model.setProperty("/customPresets",p);}}};return P;});
