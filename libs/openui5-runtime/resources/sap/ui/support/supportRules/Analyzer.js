/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object"],function(q,B){"use strict";var A=function(){this.reset();};A.prototype.getProgress=function(){return this._iTotalProgress;};A.prototype.addTask=function(t,T,o){var a={name:t,handler:T,objects:q.extend(true,{arr:o},{}).arr,progress:0};this._aTasks.push(a);this._iTotalSteps=this._iTotalSteps+a.objects.length;};A.prototype.reset=function(){this._iTotalProgress=0;this._iTotalCompletedSteps=0;this._iTotalSteps=0;this._aTasks=[];this._oCurrent={};this._bRunning=false;this._iStartTS=0;this.startedAt=null;this.finishedAt=null;this.elapsedTime=null;};A.prototype.running=function(){return this._bRunning;};A.prototype.start=function(r){var t=this;t.resolve=r;t.startedAt=new Date();var p=new Promise(function(a,b){t._iStartTS=performance.now();t._start(undefined,a);});return p;};A.prototype._start=function(c,r){if(this._bRunning&&!c){return;}if(this._oCurrent.task){if(c){this._next(r);}return;}for(var i=0;i<this._aTasks.length;i++){if(this._aTasks[i].progress<100){this._oCurrent={task:this._aTasks[i],index:-1};this._bRunning=true;q.sap.delayedCall(1,this,"_next",[r]);break;}else{this._bRunning=false;}}};A.prototype._next=function(r){if(!this._bRunning){return;}var c=this._oCurrent;if(c.task){c.index++;if(c.task.objects[c.index]){this._iTotalCompletedSteps++;this._iTotalProgress=Math.min(Math.ceil((this._iTotalCompletedSteps/this._iTotalSteps)*100),100);c.task.handler(c.task.objects[c.index]);c.task.progress=Math.min(Math.ceil((c.index/c.task.objects.length)*100),100);}else{c.task.progress=100;this._iTotalCompletedSteps=this._iTotalCompletedSteps+(c.task.objects.length-c.index);this._iTotalProgress=Math.min(Math.ceil((this._iTotalCompletedSteps/this._iTotalSteps)*100),100);this._oCurrent={};this.finishedAt=new Date();this.elapsedTime=this.finishedAt.getTime()-this.startedAt.getTime();this._bRunning=false;r();}if(performance.now()-this._iStartTS>100){q.sap.delayedCall(5,this,"_start",[true,r]);this._iStartTS=performance.now();}else{q.sap.delayedCall(0,this,"_start",[true,r]);}}};A.prototype.getElapsedTimeString=function(){if(!this.elapsedTime){return;}var d=new Date(null);d.setHours(0,0,0,0);d.setMilliseconds(this.elapsedTime);var b=[(d.getHours()<10?"0":"")+d.getHours(),(d.getMinutes()<10?"0":"")+d.getMinutes(),(d.getSeconds()<10?"0":"")+d.getSeconds(),d.getMilliseconds()];return b.join(":");};return A;},false);
