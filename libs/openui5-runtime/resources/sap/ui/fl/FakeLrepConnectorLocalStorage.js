/*
 * ! UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/FakeLrepLocalStorage","sap/ui/fl/FakeLrepConnector","sap/ui/fl/LrepConnector","sap/ui/fl/Cache","sap/ui/fl/ChangePersistenceFactory"],function(F,a,L,C,b){"use strict";c._oBackendInstances={};function c(s){this.mSettings=jQuery.extend({"isKeyUser":true,"isAtoAvailable":false,"isProductiveSystem":false},s);}jQuery.extend(c.prototype,a.prototype);c.prototype.create=function(v){var r;if(Array.isArray(v)){r=v.map(function(m){return this._saveChange(m);}.bind(this));}else{r=this._saveChange(v);}return Promise.resolve({response:r,status:'success'});};c.prototype._saveChange=function(m){if(!m.creation){m.creation=new Date().toISOString();}F.saveChange(m.fileName,m);return m;};c.prototype.update=function(m,s,d,i){return Promise.resolve({response:this._saveChange(m),status:'success'});};c.prototype.deleteChange=function(o){F.deleteChange(o.fileName);return Promise.resolve({response:undefined,status:"nocontent"});};c.prototype.deleteChanges=function(){F.deleteChanges();return Promise.resolve({response:undefined,status:"nocontent"});};c.prototype.loadChanges=function(s){var d=F.getChanges();return new Promise(function(r,e){var f={changes:{changes:d,settings:this.mSettings},componentClassName:s};r(f);}.bind(this));};c.enableFakeConnector=function(s,A,d){s=s||{};if(A&&d){var o=b.getChangePersistenceForComponent(A,d);if(!(o._oConnector instanceof c)){C.clearEntry(A,d);if(!c._oBackendInstances[A]){c._oBackendInstances[A]={};}c._oBackendInstances[A][d]=o._oConnector;o._oConnector=new c(s);}return;}C.clearEntries();if(c.enableFakeConnector.original){return;}c.enableFakeConnector.original=L.createConnector;L.createConnector=function(){if(!c._oFakeInstance){c._oFakeInstance=new c(s);}return c._oFakeInstance;};};c.disableFakeConnector=function(A,s){if(A&&s){var o=b.getChangePersistenceForComponent(A,s);if(!(o._oConnector instanceof L)){C.clearEntry(A,s);if(c._oBackendInstances[A]&&c._oBackendInstances[A][s]){o._oConnector=c._oBackendInstances[A][s];c._oBackendInstances[A][s]=undefined;}}return;}C.clearEntries();if(c.enableFakeConnector.original){L.createConnector=c.enableFakeConnector.original;c.enableFakeConnector.original=undefined;c._oFakeInstance=undefined;}};return c;},true);
