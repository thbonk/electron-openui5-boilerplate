/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/support/apps/contentbrowser/utils/HtmlEscapeUtils"],function(H){"use strict";var L={};L.sContentPathPrefix="/sap/bc/lrep/content";L._sXcsrfToken=undefined;L.getContent=function(l,c,r,R,b){var t=this;var g=new Promise(function(f,a){c=encodeURI(c);var s=t._getLayerSuffix(l);var C=t._getContextSuffix(s,R,r);var u=L.sContentPathPrefix+(c?"":"/")+c+s+C;t._sendContentRequest(u,f,a,b);});return g;};L.saveFile=function(l,n,f,F,c){var t=this;return new Promise(function(r,R){if(!l||n===undefined||!f||!F){R();}var C=H.unescapeSlashes(n)+f+"."+F;var s=t._getLayerSuffix(l);var u=L.sContentPathPrefix+C+s;t._getTokenAndSendPutRequest.call(t,u,c,r,R);});};L.deleteFile=function(l,n,f,F){var t=this;return new Promise(function(r,R){if(!l||n===undefined||!f||!F){R();}var c=H.unescapeSlashes(n)+f+"."+F;var s=t._getLayerSuffix(l);var u=L.sContentPathPrefix+c+s;t._getTokenAndSendDeletionRequest.call(t,u,r,R);});};L._getXcsrfToken=function(u){var t=this;return new Promise(function(r,R){if(t._sXcsrfToken){r(t._sXcsrfToken);}jQuery.ajax({url:u,type:"HEAD",beforeSend:function(o){o.setRequestHeader("X-CSRF-Token","fetch");},success:function(d,m,j){t._sXcsrfToken=j.getResponseHeader("x-csrf-token");r(t._sXcsrfToken);},error:function(j,T,e){L._reportError(j,T,e);R(e);}});});};L._getLayerSuffix=function(l){if(l==="All"){return"";}return"?layer="+l;};L._getContextSuffix=function(l,r,R){var s="";if(!r){s+=(l?"&":"?");s+="dt=true";}if(!!R){s+=(l||s?"&":"?");s+="metadata=true";}return s;};L._reportError=function(j,t,e){sap.ui.require(["sap/ui/fl/support/apps/contentbrowser/utils/ErrorUtils"],function(E){E.displayError("Error",j.status,t+": "+e);});};L._sendContentRequest=function(u,r,R,b){var o={url:u,type:"GET",success:function(d){r(d);},error:function(j,t,e){L._reportError(j,t,e);R(e);}};if(!!b){o.dataType="text";}jQuery.ajax(o);};L._getTokenAndSendPutRequest=function(u,d,r,R){var t=this;L._getXcsrfToken(u).then(function(x){t._sendPutRequest(x,u,d,r,R);});};L._sendPutRequest=function(x,u,d,r,R){jQuery.ajax({url:u,contentType:"text/plain",data:d,beforeSend:function(o){o.setRequestHeader("X-CSRF-Token",x);},type:"PUT",success:function(){r();},error:function(j,t,e){L._reportError(j,t,e);R(e);}});};L._getTokenAndSendDeletionRequest=function(u,r,R){var t=this;this._getXcsrfToken(u).then(function(x){t._sendDeletionRequest(x,u,r,R);});};L._sendDeletionRequest=function(x,u,r,R){jQuery.ajax({url:u,beforeSend:function(o){o.setRequestHeader("X-CSRF-Token",x);},type:"DELETE",success:function(d){r(d);},error:function(j,t,e){L._reportError(j,t,e);R(e);}});};return L;});
