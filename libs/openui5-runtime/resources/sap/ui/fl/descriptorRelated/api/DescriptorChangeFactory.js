/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/ChangePersistenceFactory","sap/ui/fl/ChangePersistence","sap/ui/fl/Change","sap/ui/fl/descriptorRelated/internal/Utils","sap/ui/fl/descriptorRelated/api/Settings"],function(C,a,b,U,S){"use strict";var D=function(m,i,s){this._mChangeFile=m;this._mChangeFile.packageName='$TMP';this._oInlineChange=i;this._sTransportRequest=null;this._oSettings=s;};D.prototype.setTransportRequest=function(t){try{U.checkTransportRequest(t);}catch(e){return Promise.reject(e);}this._sTransportRequest=t;return Promise.resolve();};D.prototype.setPackage=function(p){try{U.checkPackage(p);}catch(e){return Promise.reject(e);}this._mChangeFile.packageName=p;return Promise.resolve();};D.prototype.submit=function(){var s=this._mChangeFile.reference;var o=C.getChangePersistenceForComponent(s);var d=this._getChangeToSubmit();o.addChange(d);return o.saveDirtyChanges();};D.prototype._getChangeToSubmit=function(){var o=new b(this._getMap());if(this._sTransportRequest){o.setRequest(this._sTransportRequest);}else if(this._oSettings.isAtoEnabled()&&this._mChangeFile.layer=='CUSTOMER'){o.setRequest('ATO_NOTIFICATION');}return o;};D.prototype._getMap=function(){var i=this._oInlineChange.getMap();this._mChangeFile.content=i.content;this._mChangeFile.texts=i.texts;return this._mChangeFile;};D.prototype.getJson=function(){return jQuery.extend(true,{},this._getMap());};var c=function(){};c.prototype.createNew=function(r,i,l){var s=function(_,I){if(_["setHostingIdForTextKey"]){_.setHostingIdForTextKey(I);}};s(i,r);var p={};p.changeType=i._getChangeType();p.componentName=r;p.reference=r;if(!l){p.layer='CUSTOMER';}else{if(l!='VENDOR'&&l!='CUSTOMER'){throw new Error("Parameter \"sLayer\" needs to be 'VENDOR', 'CUSTOMER'");}p.layer=l;}var m=b.createInitialFileContent(p);return S.getInstance().then(function(o){return Promise.resolve(new D(m,i,o));});};return c;},true);
