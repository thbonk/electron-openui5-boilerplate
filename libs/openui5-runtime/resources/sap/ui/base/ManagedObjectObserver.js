/*
 * ! UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/Object','sap/ui/base/ManagedObject','jquery.sap.script'],function(q,B,M){"use strict";var a=B.extend("sap.ui.base.ManagedObjectObserver",{constructor:function(C){if(!C&&typeof C!=="function"){throw new Error("Missing callback function in ManagedObjectObserver constructor");}this._fnCallback=C;}});a.prototype.observe=function(o,C){if(!(o instanceof M)){if(o==null){return;}throw new TypeError("ManagedObjectObserver can only handle ManagedObjects, but observe was called for "+o);}j(o,C);c(o,this,C);};a.prototype.unobserve=function(o,C){if(!(o instanceof M)){if(o==null){return;}throw new TypeError("ManagedObjectObserver can only handle ManagedObjects, but unobserve was called for "+o);}j(o,C);r(o,this,C);};a.prototype.isObserved=function(o,C){if(!(o instanceof M)){if(o==null){return false;}throw new TypeError("ManagedObjectObserver can only handle ManagedObjects, but isObserved was called for "+o);}return d(o,this,C);};a.prototype.disconnect=function(){e(this);};var O={},t=Object.create(null);O.propertyChange=function(m,n,o,N){h("properties",m,n,function(){return{type:"property",old:o,current:N};});};O.aggregationChange=function(m,n,s,o){h("aggregations",m,n,function(){return{type:"aggregation",mutation:s,children:Array.isArray(o)?o:null,child:!Array.isArray(o)?o:null};});};O.associationChange=function(m,n,s,i){h("associations",m,n,function(){return{type:"association",mutation:s,ids:i};});};function h(T,o,n,C){var I=o.getId(),k=t[I];if(k){var l;for(var i=0;i<k.listeners.length;i++){if(b(k.configurations[i],T,n)){if(!l){l=C();l.name=n;l.object=o;}var L=k.listeners[i];L._fnCallback(l);}}}}function b(C,T,n){if(C==null||!T||!n){return false;}return C[T]===true||(Array.isArray(C[T])&&C[T].indexOf(n)>-1);}function c(T,l,C){var i=T.getId(),o=t[i];if(!o){o=t[i]={listeners:[],configurations:[],object:T};}var I=o.listeners.indexOf(l);if(I===-1){o.listeners.push(l);o.configurations.push(C);}else{u(o.configurations[I],C,false);}if(!T._observer){T._observer=O;}}function r(T,l,C){var i=T.getId(),o=t[i];if(!o){return;}var I=o.listeners.indexOf(l);if(I>=0){u(o.configurations[I],C,true);}if(!T._observer){T._observer=O;}}function d(T,l,C){var i=T.getId(),o=t[i];if(!o){return false;}var I=o.listeners.indexOf(l);if(I===-1){return false;}else{return g(o.configurations[I].properties,C.properties)&&g(o.configurations[I].aggregations,C.aggregations)&&g(o.configurations[I].associations,C.associations);}}function e(l){for(var n in t){var T=t[n];for(var i=0;i<T.listeners.length;i++){if(T.listeners[i]===l){T.listeners.splice(i,1);T.configurations.splice(i,1);}}if(T.listeners&&T.listeners.length===0){delete t[n];delete T.object._observer;}}}function u(C,A,R){C.properties=C.properties||[];f(C.properties,A.properties,R);C.aggregations=C.aggregations||[];f(C.aggregations,A.aggregations,R);C.associations=C.associations||[];f(C.associations,A.associations,R);}function f(o,A,R){if(!A){return;}for(var i=0;i<A.length;i++){var I=o.indexOf(A[i]);if(I>-1&&R){o.splice(I,1);}else if(I===-1&&!R){o.push(A[i]);}}}function g(F,s){if(!Array.isArray(s)||s.length==0){return true;}if(!Array.isArray(F)||F.length==0){return false;}var U=q.sap.unique(F.concat(s));return F.length===U.length;}function j(o,C){var m=o.getMetadata();C.properties=C.properties===true?Object.keys(m.getAllProperties()):C.properties;C.aggregations=C.aggregations===true?Object.keys(m.getAllAggregations()):C.aggregations;C.associations=C.associations===true?Object.keys(m.getAllAssociations()):C.associations;}return a;});
