/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/URI','sap/ui/Device','sap/ui/performance/trace/Passport','sap/ui/performance/trace/Interaction','sap/ui/performance/XHRInterceptor','sap/base/util/Version'],function(U,D,P,I,X,V){"use strict";var f=false,R=P.getRootId(),C=P.createGUID().substr(-8,8)+R,H=window.location.host,a=D.os.name+"_"+D.os.version,b=D.browser.name+"_"+D.browser.version,c=h(),A="",s="",e,F,S=0,d,g;function h(){var q=0;if(D.system.combi){q=1;}else if(D.system.desktop){q=2;}else if(D.system.tablet){q=4;}else if(D.system.phone){q=3;}return q;}function i(t){var q=new Date(t);return q.toISOString().replace(/[^\d]/g,'');}function j(u){var q=new U(u).host();return q&&q!==H;}function r(){X.register("PASSPORT_HEADER","open",function(){if(!j(arguments[1])){var q=I.getPending();if(q){if(s!=q.appVersion){s=q.appVersion;A=s?n(s):"";}}this.setRequestHeader("SAP-PASSPORT",P.header(e,R,P.getTransactionId(),q?q.component+A:undefined,q?q.trigger+"_"+q.event+"_"+S:undefined));}});X.register("FESR","open",function(){if(!j(arguments[1])){if(!F){F=P.getTransactionId();}if(d){this.setRequestHeader("SAP-Perf-FESRec",d);this.setRequestHeader("SAP-Perf-FESRec-opt",g);d=null;g=null;F=P.getTransactionId();S++;}}});}function k(q){return[m(R,32),m(F,32),m(q.navigation,16),m(q.roundtrip,16),m(q.duration,16),m(q.completeRoundtrips,8),m(C,40),m(q.networkTime,16),m(q.requestTime,16),m(a,20),"SAP_UI5"].join(",");}function l(q){var t=q.stepComponent||q.component;return[m(t,20,true),m(q.trigger+"_"+q.event,20,true),"",m(b,20),m(q.bytesSent,16),m(q.bytesReceived,16),"","",m(q.processing,16),q.requestCompression?"X":"","","","","",m(q.busyDuration,16),"",m(c,1),"",m(i(q.start),20),m(t,70,true)].join(",");}function m(v,L,q){if(!v){v=v===0?"0":"";}else if(typeof v==="number"){var t=v;v=Math.round(v).toString();if(v.length>L||t<0){v="-1";}}else{v=q?v.substr(-L,L):v.substr(0,L);}return v;}function n(v){var q=new V(v);return"@"+q.getMajor()+"."+q.getMinor()+"."+q.getPatch();}function o(q){d=k(q);g=l(q);}var p={};p.setActive=function(q){if(q){f=true;P.setActive(true);I.setActive(true);e=P.traceFlags();r();I.onInteractionFinished=function(t){if(t.requests.length>0){o(t);}};}else if(!q&&f){f=false;I.setActive(false);X.unregister("FESR","open");if(X.isRegistered("PASSPORT_HEADER","open")){X.register("PASSPORT_HEADER","open",function(){this.setRequestHeader("SAP-PASSPORT",P.header(e,R,P.getTransactionId()));});}I.onInteractionFinished=null;}};p.getActive=function(){return f;};return p;});
