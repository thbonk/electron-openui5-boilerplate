/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/ui/commons/Button','sap/ui/core/Control','sap/ui/core/theming/Parameters','./library','./FeederRenderer','sap/ui/commons/library','sap/ui/Device'],function(q,B,C,P,l,F,c,D){"use strict";var a=c.ButtonStyle;var b=l.FeederType;var d=C.extend("sap.ui.ux3.Feeder",{metadata:{library:"sap.ui.ux3",properties:{thumbnailSrc:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},text:{type:"string",group:"Data",defaultValue:null},type:{type:"sap.ui.ux3.FeederType",group:"Appearance",defaultValue:b.Large},placeholderText:{type:"string",group:"Appearance",defaultValue:null}},events:{submit:{parameters:{text:{type:"string"}}}}}});d.prototype.init=function(){this.rb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.ux3");this.oSendButton=new B(this.getId()+"-send",{style:a.Emph,icon:"sap-icon://feeder-arrow"}).setParent(this);this.oSendButton.attachEvent('press',this.handleSendButtonPress,this);};d.prototype.initSendButton=function(){if(this.getText()==""){this.oSendButton.setProperty('enabled',false,true);}};d.prototype.exit=function(){this.rb=undefined;this.oInput=undefined;if(this.oSendButton){this.oSendButton.destroy();delete this.oSendButton;}};d.prototype.onAfterRendering=function(){this.oInput=this.$("input");};d.prototype.onclick=function(e){var t=e.target.getAttribute('ID');switch(t){case(this.getId()+'-send'):break;case(this.getId()+'-input'):break;default:break;}};d.prototype.onfocusin=function(e){this.oInput.find(".sapUiFeederEmptyText").remove();};d.prototype.onfocusout=function(e){var t=this.oInput.text();if(t==""){this.oInput.empty();this.oInput.append(F.getEmptyTextInfo(this));}this.setProperty("text",t,true);};d.prototype.getFocusDomRef=function(){return this.getDomRef("input");};d.prototype.onkeyup=function(e){if(this.oInput.text()==""){this.oSendButton.setEnabled(false);}else{this.oSendButton.setEnabled(true);}};d.prototype.handleSendButtonPress=function(e){var t=this.getMultilineText(this.oInput);this.setProperty("text",t,true);this.fireSubmit({text:t});this.setText('');};d.prototype.getMultilineText=function(I){function p(n){var e;var t='';for(var i=0;i<n.length;i++){e=n[i];if(e.nodeType===3||e.nodeType===4){if(!((D.browser.msie||D.browser.edge)&&e.nodeValue==='\xA0')){t+=e.nodeValue.replace(/\n/g,'');}}if(e.nodeName==='DIV'||e.nodeName==='P'||(e.nodeName==='BR'&&!D.browser.webkit)){if(e.nodeName==='BR'&&D.browser.firefox&&i===n.length-1&&q(e).attr("type")==="_moz"){continue;}if(!((D.browser.msie||D.browser.edge)&&t==='')&&!((D.browser.firefox||D.browser.webkit)&&t===''&&e.nodeName==='P')&&!(D.browser.webkit&&e.nodeName==='P'&&e.textContent.match(/^(\n)*$/))){t+='\n';}}if(e.nodeType!==8){t+=p(e.childNodes);}}return t;}return p(I.get(0).childNodes);};d.prototype.getThumbnailSrc=function(){var t=this.getProperty("thumbnailSrc");if(!t||t==""){var p=this.getParent();if(p&&(p instanceof sap.ui.ux3.Feed||p instanceof sap.ui.ux3.FeedChunk)){t=p.getFeederThumbnailSrc();}}return t;};d.prototype.onpaste=function(e){if(D.browser.firefox){setTimeout(this.onAfterPaste.bind(this),10);}};d.prototype.onAfterPaste=function(){var e=this.oInput.get(0).childNodes;for(var i=0;i<e.length;i++){var o=e[i];if(o.nodeName=="PRE"){q(o).css("overflow","hidden");}}};return d;});
