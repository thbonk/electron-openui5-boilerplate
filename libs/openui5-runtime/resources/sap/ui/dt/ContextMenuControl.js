/*
 * ! UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./library','sap/ui/unified/Menu','sap/ui/unified/MenuItem'],function(q,l,M,a){"use strict";var C=M.extend("sap.ui.dt.ContextMenuControl",{metadata:{library:"sap.ui.dt",properties:{},associations:{},events:{}},renderer:{}});C.prototype.init=function(){M.prototype.init.apply(this,arguments);this._fnOnKeyDown=this._onKeyDown.bind(this);q(document).keydown(this._fnOnKeyDown);this.attachBrowserEvent("contextmenu",this._onContextMenu,this);this._oOverlayDomRef=document.body;};C.prototype.exit=function(){M.prototype.exit.apply(this,arguments);q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;this.detachBrowserEvent("contextmenu");};C.prototype.setOverlayDomRef=function(o){this._oOverlayDomRef=o.getDomRef();};C.prototype.setMenuItems=function(m,t){this.destroyItems();m.forEach(function(i){if(!i.available||i.available(t)){var e=!i.enabled||i.enabled(t);var T=i.text;if(typeof i.text==="function"){T=i.text(t);}var o=new a({text:T,enabled:e});o.data({id:i.id});if((i.startSection&&typeof(i.startSection)==="boolean")||(typeof(i.startSection)==="function"&&i.startSection(t.getElementInstance()))){o.setStartsSection(true);}this.addItem(o);}},this);return this;};C.prototype._open=function(p,P){if(this.getItems().length===0){return;}var m=p;var b=P;var X=m;var Y=b;var c=q('body').width();var d=q('body').height();if(!this.getDomRef()){this.open(false,undefined,undefined,undefined,undefined,-2000+" "+-2000,"none");}var e=this.$().context.clientWidth;var f=this.$().context.clientHeight;var x=(c-m<e)?e:0;var y=(d-b<f)?f:0;X=((c/2-m)*-1)+e/2+2-x;Y=((d/2-b)*-1)+f/2+2-y;var g=b-f;if(g<0&&y!==0){Y=Y-g;}this.close();this.open(true,this._oOverlayDomRef,undefined,undefined,document.body,X+" "+Y,"flip");};C.prototype.openMenu=function(c){this._open(c.pageX,c.pageY);};C.prototype._onKeyDown=function(e){if(!this.bOpen){q(document).off("keydown",this._fnOnKeyDown);delete this._fnOnKeyDown;return;}if((e.keyCode===q.sap.KeyCodes.F10)&&(e.shiftKey===true)&&(e.altKey===false)&&(e.ctrlKey===false)){e.preventDefault();}};C.prototype._onContextMenu=function(e){if(!this.bOpen){this.detachBrowserEvent("contextmenu");return;}if(e.preventDefault){e.preventDefault();}};return C;},true);
