/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","./_Helper","./_MetadataConverter"],function(q,_,a){"use strict";var e="http://docs.oasis-open.org/odata/ns/edmx",V,A=a.oAnnotationConfig,o={"Reference":{"Include":{__processor:a.processAlias}},"DataServices":{"Schema":{__processor:a.processAlias}}},s={"Property":{__processor:H,__include:[A]},"NavigationProperty":{__processor:D,__include:[A],"OnDelete":{__processor:F,__include:[A]},"ReferentialConstraint":{__processor:G,__include:[A]}}},E={"NavigationPropertyBinding":{__processor:t}},b={"Parameter":{__processor:u,__include:[A]},"ReturnType":{__processor:w,__include:[A]}},f={__processor:d,"Reference":{__processor:v,__include:[A],"Include":{__processor:n},"IncludeAnnotations":{__processor:r}},"DataServices":{"Schema":{__processor:a.processSchema,__include:[a.oAnnotationsConfig,A],"Action":{__processor:p,__include:[b,A]},"Function":{__processor:p,__include:[b,A]},"EntityType":{__processor:i,__include:[s,A],"Key":{"PropertyRef":{__processor:j}}},"ComplexType":{__processor:c,__include:[s,A]},"EntityContainer":{__processor:g,__include:[A],"ActionImport":{__processor:m.bind(null,"Action"),__include:[A]},"EntitySet":{__processor:h,__include:[E,A]},"FunctionImport":{__processor:m.bind(null,"Function"),__include:[A]},"Singleton":{__processor:x,__include:[E,A]}},"EnumType":{__processor:k,__include:[A],"Member":{__processor:l,__include:[A]}},"Term":{__processor:y,__include:[A]},"TypeDefinition":{__processor:C,__include:[A]}}}};function p(I,J){var K=I.localName,Q=J.namespace+I.getAttribute("Name"),L={$kind:K};V.processAttributes(I,L,{"IsBound":V.setIfTrue,"EntitySetPath":V.setValue,"IsComposable":V.setIfTrue});V.getOrCreateArray(J.result,Q).push(L);J.actionOrFunction=L;V.annotatable(J,L);}function c(I,J){z(I,J,{"$kind":"ComplexType"});}function d(I,J){V.processAttributes(I,J.result,{"Version":V.setValue});}function g(I,J){var Q=J.namespace+I.getAttribute("Name");J.result[Q]=J.entityContainer={"$kind":"EntityContainer"};J.result.$EntityContainer=Q;V.annotatable(J,Q);}function h(I,J){var N=I.getAttribute("Name");J.entityContainer[N]=J.entitySet={$kind:"EntitySet",$Type:V.resolveAlias(I.getAttribute("EntityType"),J)};V.processAttributes(I,J.entitySet,{"IncludeInServiceDocument":V.setIfFalse});V.annotatable(J,N);}function i(I,J){z(I,J,{$kind:"EntityType"});}function j(I,J){var K=I.getAttribute("Alias"),L,N=I.getAttribute("Name");if(K){L={};L[K]=N;}else{L=N;}V.getOrCreateArray(J.type,"$Key").push(L);}function k(I,J){var Q=J.namespace+I.getAttribute("Name"),K={"$kind":"EnumType"};V.processAttributes(I,K,{"IsFlags":V.setIfTrue,"UnderlyingType":function(L){return L!=="Edm.Int32"?L:undefined;}});J.result[Q]=J.enumType=K;J.enumTypeMemberCounter=0;V.annotatable(J,Q);}function l(I,J){var N=I.getAttribute("Name"),K=I.getAttribute("Value"),L;if(K){L=parseInt(K,10);if(!_.isSafeInteger(L)){L=K;}}else{L=J.enumTypeMemberCounter;J.enumTypeMemberCounter++;}J.enumType[N]=L;V.annotatable(J,N);}function m(W,I,J){var K={$kind:W+"Import"},N=I.getAttribute("Name");K["$"+W]=V.resolveAlias(I.getAttribute(W),J);V.processAttributes(I,K,{"EntitySet":function(L){return V.resolveTargetPath(L,J);},"IncludeInServiceDocument":V.setIfTrue});J.entityContainer[N]=K;V.annotatable(J,N);}function n(I,J){var K=V.getOrCreateArray(J.reference,"$Include");K.push(I.getAttribute("Namespace")+".");}function r(I,J){var R=J.reference,K={"$TermNamespace":I.getAttribute("TermNamespace")+"."},L=V.getOrCreateArray(R,"$IncludeAnnotations");V.processAttributes(I,K,{"TargetNamespace":function setValue(M){return M?M+".":M;},"Qualifier":V.setValue});L.push(K);}function t(I,J){var N=V.getOrCreateObject(J.entitySet,"$NavigationPropertyBinding");N[I.getAttribute("Path")]=V.resolveTargetPath(I.getAttribute("Target"),J);}function u(I,J){var K=J.actionOrFunction,P={};B(I.getAttribute("Type"),P,J);V.processAttributes(I,P,{"Name":V.setValue,"Nullable":V.setIfFalse});V.processFacetAttributes(I,P);V.getOrCreateArray(K,"$Parameter").push(P);V.annotatable(J,P);}function v(I,J){var R=V.getOrCreateObject(J.result,"$Reference");J.reference=R[I.getAttribute("Uri")]={};V.annotatable(J,J.reference);}function w(I,J){var K=J.actionOrFunction,R={};B(I.getAttribute("Type"),R,J);V.processAttributes(I,R,{"Nullable":V.setIfFalse});V.processFacetAttributes(I,R);K.$ReturnType=R;V.annotatable(J,R);}function x(I,J){var N=I.getAttribute("Name");J.entityContainer[N]=J.entitySet={$kind:"Singleton",$Type:V.resolveAlias(I.getAttribute("Type"),J)};V.annotatable(J,N);}function y(I,J){var Q=J.namespace+I.getAttribute("Name"),T={$kind:"Term"};B(I.getAttribute("Type"),T,J);V.processAttributes(I,T,{"Nullable":V.setIfFalse,"BaseTerm":function(K){return K?V.resolveAlias(K,J):undefined;}});V.processFacetAttributes(I,T);J.result[Q]=T;V.annotatable(J,Q);}function z(I,J,T){var Q=J.namespace+I.getAttribute("Name");V.processAttributes(I,T,{"OpenType":V.setIfTrue,"HasStream":V.setIfTrue,"Abstract":V.setIfTrue,"BaseType":function(K){return K?V.resolveAlias(K,J):undefined;}});J.result[Q]=J.type=T;V.annotatable(J,Q);}function B(T,P,I){var M=V.rCollection.exec(T);if(M){P.$isCollection=true;T=M[1];}P.$Type=V.resolveAlias(T,I);}function C(I,J){var Q=J.namespace+I.getAttribute("Name"),T={"$kind":"TypeDefinition","$UnderlyingType":I.getAttribute("UnderlyingType")};J.result[Q]=T;V.processFacetAttributes(I,T);V.annotatable(J,Q);}function D(I,J){var N=I.getAttribute("Name"),P={$kind:"NavigationProperty"};B(I.getAttribute("Type"),P,J);V.processAttributes(I,P,{"Nullable":V.setIfFalse,"Partner":V.setValue,"ContainsTarget":V.setIfTrue});J.type[N]=J.navigationProperty=P;V.annotatable(J,N);}function F(I,J){J.navigationProperty.$OnDelete=I.getAttribute("Action");V.annotatable(J,J.navigationProperty,"$OnDelete");}function G(I,J){var P=I.getAttribute("Property"),R=V.getOrCreateObject(J.navigationProperty,"$ReferentialConstraint");R[P]=I.getAttribute("ReferencedProperty");V.annotatable(J,R,P);}function H(I,J){var N=I.getAttribute("Name"),P={"$kind":"Property"};B(I.getAttribute("Type"),P,J);V.processAttributes(I,P,{"Nullable":V.setIfFalse,"DefaultValue":V.setValue});V.processFacetAttributes(I,P);J.type[N]=P;V.annotatable(J,N);}V=q.extend({},a,{convertXMLMetadata:function(I,U){var J,K;q.sap.measure.average("convertXMLMetadata","","sap.ui.model.odata.v4.lib._V4MetadataConverter");K=I.documentElement;if(K.localName!=="Edmx"||K.namespaceURI!==e){throw new Error(U+" is not a valid OData V4 metadata document");}J={"actionOrFunction":null,"aliases":{},"annotatable":null,"entityContainer":null,"entitySet":null,"enumType":null,"enumTypeMemberCounter":0,"namespace":null,"navigationProperty":null,"processFacetAttributes":V.processFacetAttributes,"processTypedCollection":B,"reference":null,"schema":null,"type":null,"result":{}};V.traverse(K,J,o);V.traverse(K,J,f);if(J.result.$Version!=="4.0"){throw new Error(U+": Unsupported OData version "+J.result.$Version);}q.sap.measure.end("convertXMLMetadata");return J.result;},processFacetAttributes:function(I,R){V.processAttributes(I,R,{"MaxLength":function(J){return J==="max"?undefined:V.setNumber(J);},"Precision":V.setNumber,"Scale":function(J){return J==="variable"?J:V.setNumber(J);},"SRID":V.setValue,"Unicode":V.setIfFalse});}});return V;},false);
