/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global"],function(q){"use strict";var a={"POST":true,"PUT":true,"PATCH":true,"DELETE":true},b,r=/\$\d+/,c=/(\S*?)=(?:"(.+)"|(\S+))/;function g(C){var B=d(C,"boundary"),m=C.trim().indexOf("multipart/mixed");if(m!==0||!B){throw new Error('Invalid $batch response header "Content-Type": '+C);}B=q.sap.escapeRegExp(B);return new RegExp('--'+B+'-{0,2} *\r\n');}function d(H,p){var P,i=H.split(";"),m;p=p.toLowerCase();for(P=1;P<i.length;P++){m=c.exec(i[P]);if(m[1].toLowerCase()===p){return m[2]||m[3];}}}function e(m){var C=h(m,"content-type");return C.indexOf("multipart/mixed;")===0?C:undefined;}function f(m){var C=h(m,"content-id"),R;if(!C){throw new Error("Content-ID MIME header missing for the change set response.");}R=parseInt(C,10);if(isNaN(R)){throw new Error("Invalid Content-ID value in change set response.");}return R;}function h(H,k){var i,l,m=H.split("\r\n");for(i=0;i<m.length;i++){l=m[i].split(":");if(l[0].toLowerCase().trim()===k){return l[1].trim();}}}function _(C,R,I){var B=R.split(g(C)),k=[];B=B.slice(1,-1);B.forEach(function(l){var m,n,o,H,p,t,u,v,i,M,w={},x,y;y=l.split("\r\n\r\n");M=y[0];m=e(M);if(m){k.push(_(m,y.slice(1).join("\r\n\r\n"),true));return;}u=y[1].split("\r\n");v=u[0].split(" ");w.status=parseInt(v[1],10);w.statusText=v.slice(2).join(' ');w.headers={};for(i=1;i<u.length;i++){H=u[i];o=H.indexOf(':');p=H.slice(0,o).trim();t=H.slice(o+1).trim();w.headers[p]=t;if(p.toLowerCase()==="content-type"){n=d(t,"charset");if(n&&n.toLowerCase()!=="utf-8"){throw new Error('Unsupported "Content-Type" charset: '+n);}}}w.responseText=y[2].slice(0,-2);if(I){x=f(M);k[x]=w;}else{k.push(w);}});return k;}function s(H){var i,k=[];for(i in H){k=k.concat(i,":",H[i],"\r\n");}return k;}function j(R,C){var B=(C!==undefined?"changeset_":"batch_")+q.sap.uid(),i=C!==undefined,k=[];if(i){k=k.concat("Content-Type: multipart/mixed;boundary=",B,"\r\n\r\n");}R.forEach(function(o,l){var m="",u=o.url;if(i){m="Content-ID:"+l+"."+C+"\r\n";}k=k.concat("--",B,"\r\n");if(Array.isArray(o)){if(i){throw new Error('Change set must not contain a nested change set.');}k=k.concat(j(o,l).body);}else{if(i&&!a[o.method]){throw new Error("Invalid HTTP request method: "+o.method+". Change set must contain only POST, PUT, PATCH or DELETE requests.");}u=u.replace(r,"$&."+C);k=k.concat("Content-Type:application/http\r\n","Content-Transfer-Encoding:binary\r\n",m,"\r\n",o.method," ",u," HTTP/1.1\r\n",s(o.headers),"\r\n",JSON.stringify(o.body)||"","\r\n");}});k=k.concat("--",B,"--\r\n");return{body:k,batchBoundary:B};}b={deserializeBatchResponse:function(C,R){return _(C,R,false);},serializeBatchRequest:function(R){var B=j(R);return{body:B.body.join(""),headers:{"Content-Type":"multipart/mixed; boundary="+B.batchBoundary,"MIME-Version":"1.0"}};}};return b;},false);
