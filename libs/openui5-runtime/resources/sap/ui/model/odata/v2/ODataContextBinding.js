/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/model/ContextBinding','sap/ui/model/ChangeReason'],function(q,C,a){"use strict";var O=C.extend("sap.ui.model.odata.v2.ODataContextBinding",{constructor:function(m,p,c,P,e){C.call(this,m,p,c,P,e);this.bRefreshGroupId=undefined;}});O.prototype.initialize=function(){var t=this,r,c=this.isRelative()&&this.oContext&&this.oContext.bCreated,R;if(!this.oModel.oMetadata.isLoaded()||!this.bInitial){return;}this.bInitial=false;r=this.oModel.resolve(this.sPath,this.oContext);if(!r||c){this.oElementContext=null;this._fireChange({reason:a.Context});return;}R=this.oModel._isReloadNeeded(r,this.mParameters);if(R){this.fireDataRequested();}this.oModel.createBindingContext(this.sPath,this.oContext,this.mParameters,function(o){var d;t.oElementContext=o;t._fireChange({reason:a.Context});if(R){if(t.oElementContext){d=t.oElementContext.getObject(t.mParameters);}t.oModel.callAfterUpdate(function(){t.fireDataReceived({data:d});});}},R);};O.prototype.checkUpdate=function(f){var c;if(this.bInitial){return;}c=this.oModel.createBindingContext(this.sPath,this.oContext,this.mParameters);if(c&&c!==this.oElementContext){this.oElementContext=c;this._fireChange({reason:a.Context});}};O.prototype.refresh=function(f,g){if(typeof f==="string"){g=f;f=false;}this.sRefreshGroup=g;this._refresh(f);this.sRefreshGroup=undefined;};O.prototype._refresh=function(f,c){var t=this,d,k,s,b=false,p=this.mParameters,e=this.isRelative()&&this.oContext&&this.oContext.bCreated,r=this.oModel.resolve(this.sPath,this.oContext);if(this.bInitial||e){return;}if(c){s=this.oModel._getObject(this.sPath,this.oContext);if(s){k=this.oModel._getKey(s);if(k in c){b=true;}}}else{b=true;}if(f||b){if(r){this.fireDataRequested();}if(this.sRefreshGroup){p=q.extend({},this.mParameters);p.groupId=this.sRefreshGroup;}this.oModel.createBindingContext(this.sPath,this.oContext,p,function(o){if(t.oElementContext===o){if(f){t._fireChange({reason:a.Context});}}else{t.oElementContext=o;t._fireChange({reason:a.Context});}if(t.oElementContext){d=t.oElementContext.getObject(t.mParameters);}if(r){t.oModel.callAfterUpdate(function(){t.fireDataReceived({data:d});});}},true);}};O.prototype.setContext=function(c){var t=this,d,r,d,b=c&&c.bCreated,R;if(this.oContext!==c){this.oContext=c;if(this.bInitial||!this.isRelative()){return;}r=this.oModel.resolve(this.sPath,this.oContext);if(!r||b){if(this.oElementContext!==null){this.oElementContext=null;this._fireChange({reason:a.Context});}return;}d=this.oModel._getObject(this.sPath,this.oContext);R=this.oModel._isReloadNeeded(r,d,this.mParameters);if(R){this.fireDataRequested();}this.oModel.createBindingContext(this.sPath,this.oContext,this.mParameters,function(c){t.oElementContext=c;t._fireChange({reason:a.Context});if(r&&R){if(t.oElementContext){d=t.oElementContext.getObject(t.mParameters);}t.oModel.callAfterUpdate(function(){t.fireDataReceived({data:d});});}},R);}};return O;});
