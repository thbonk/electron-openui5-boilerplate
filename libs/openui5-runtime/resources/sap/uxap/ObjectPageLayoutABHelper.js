/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Metadata","sap/ui/core/CustomData","./AnchorBar","sap/m/Button","sap/ui/core/IconPool"],function(q,M,C,A,B,I){"use strict";var a=M.createClass("sap.uxap._helpers.AB",{constructor:function(o){this._oObjectPageLayout=o;this._iScrollDuration=o._iScrollToSectionDuration;}});a.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout;};a.prototype._getAnchorBar=function(){var o=this.getObjectPageLayout().getAggregation("_anchorBar");if(!o){o=new A({id:this.getObjectPageLayout().getId()+"-anchBar",showPopover:this.getObjectPageLayout().getShowAnchorBarPopover()});this.getObjectPageLayout().setAggregation("_anchorBar",o,true);}return o;};a.prototype._buildAnchorBar=function(){var s=this.getObjectPageLayout().getSections()||[],o=this._getAnchorBar();if(o&&this.getObjectPageLayout().getShowAnchorBar()){o._resetControl();s.forEach(function(S){if(!S.getVisible()||!S._getInternalVisible()){return;}var b,c=S.getSubSections()||[];b=this._buildAnchorBarButton(S,true);if(b){o.addContent(b);c.forEach(function(d){if(!d.getVisible()||!d._getInternalVisible()){return;}var e=this._buildAnchorBarButton(d,false);if(e){o.addContent(e);}},this);}},this);}};a.prototype._focusOnSectionWhenUsingKeyboard=function(e){var s=e.srcControl.data(),S=sap.ui.getCore().byId(s.sectionId),o=this.getObjectPageLayout();if(S&&!s.bHasSubMenu&&!o.getUseIconTabBar()){q.sap.delayedCall(this._iScrollDuration,S.$(),"focus");}};a.prototype._buildAnchorBarButton=function(s,i){var b=null,o=this.getObjectPageLayout(),c,d=this._getAnchorBar(),e,S=s.getAggregation("subSections"),f=this._focusOnSectionWhenUsingKeyboard.bind(this),E={onsapenter:f,onsapspace:f};if(s.getVisible()&&s._getInternalVisible()){c=s.getCustomAnchorBarButton();if(!c){e=d.getId()+"-"+s.getId()+"-anchor";b=new B({ariaDescribedBy:s,id:e});b.addEventDelegate(E);var t=(s._getInternalTitle()!="")?s._getInternalTitle():s.getTitle();b.setText(t);}else{b=c.clone();}o._oSectionInfo[s.getId()].buttonId=b.getId();b.addCustomData(new C({key:"sectionId",value:s.getId()}));b.addCustomData(new C({key:"bTitleVisible",value:s._getInternalTitleVisible()}));if(!i){b.addCustomData(new C({key:"secondLevel",value:true}));}if(S&&S.length>1){var v=S.filter(function(g){return g.getVisible();}).length;if(v>1){b.addCustomData(new C({key:"bHasSubMenu",value:true}));if(o.getShowAnchorBarPopover()){b.setIcon(I.getIconURI("slim-arrow-down"));b.setIconFirst(false);}}}}return b;};return a;},false);
