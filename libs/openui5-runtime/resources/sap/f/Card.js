/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/Manifest","sap/f/CardManifest","sap/base/Log","sap/f/CardRenderer","sap/m/Text","sap/f/Avatar","sap/ui/Device","sap/ui/core/ComponentContainer"],function(l,C,M,a,L,b,T,A,D,c){"use strict";var d=C.extend("sap.f.Card",{metadata:{library:"sap.f",properties:{manifest:{type:"any",defaultValue:""},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"}},aggregations:{_header:{multiple:false,visibility:"hidden"},_content:{multiple:false,visibility:"hidden"}},events:{}}});d.prototype.init=function(){};d.prototype.onAfterRendering=function(){if(D.browser.msie){if(this._oTitle){this._oTitle.clampText();}if(this._oSubTitle){this._oSubTitle.clampText();}}};d.prototype.exit=function(){if(this._oCardManifest){this._oCardManifest.destroy();this._oCardManifest=null;}if(this._oTitle){this._oTitle.destroy();this._oTitle=null;}if(this._oSubTitle){this._oSubTitle.destroy();this._oSubTitle=null;}if(this._oAvatar){this._oAvatar.destroy();this._oAvatar=null;}};d.prototype.modifyDomRef=function(s,m){var o=this.getDomRef(),e=this.getDomRef("content");if(o){o=s?o.querySelector(s):o;if(o&&((e&&!e.contains(o))||!e)){m(o);}}return this;};d.prototype.setManifest=function(v){this.setBusy(true);this.setProperty("manifest",v,true);if(typeof v==="string"){this.initManifest(v);}else if(typeof v==="object"){this._oCardManifest=new a(v);this.applyManifestSettings();}return this;};d.prototype.setContent=function(o){this.setAggregation("_content",o);};d.prototype.initManifest=function(m){var p=M.load({manifestUrl:m,async:true});p.then(function(o){var j=o._oRawManifest;this._oCardManifest=new a(j);o._loadI18n(true).then(function(B){this._oCardManifest.registerTranslator(B);if(this._oCardManifest.get("sap.app/type")!=="card"){throw Error("sap.app/type entry in manifest is not 'card'");}this.applyManifestSettings();}.bind(this));}.bind(this));};d.prototype._setPropertyFromManifest=function(p,f,F){if(this._oCardManifest&&this.isPropertyInitial(p)){var v;if(f){v=this._oCardManifest.get("sap.card/"+f);if(!v&&F){v=this._oCardManifest.get("sap.card/"+F);}}else{v=this._oCardManifest.get("sap.card/"+p);}}};d.prototype.setBusy=function(v){this.setProperty("busy",v,true);this.modifyDomRef(null,function(o){if(v===true){o.classList.add("sapFCardLoading");}else{o.classList.remove("sapFCardLoading");}});return this;};d.prototype.applyManifestSettings=function(){this._createHeader();this._setPropertyFromManifest("subtitle");this._setPropertyFromManifest("icon");this._setPropertyFromManifest("iconColor");this._setPropertyFromManifest("iconBackgroundColor");this._setPropertyFromManifest("backgroundColor");this._setPropertyFromManifest("color");this._setPropertyFromManifest("backgroundImage");this._setPropertyFromManifest("backgroundSize");this._setContent();};d.prototype._createHeader=function(h){var h=this._oCardManifest.get("sap.card/header");if(h&&h.type){switch(h.type){case"kpi":sap.ui.require(["sap/f/cards/header/Kpi"],this._setCardHeader.bind(this));break;default:{L.error("Header type '"+h.type+"' was not recognised.","sap.f.Card");}}}else{this._createTitle();this._createSubTitle();this._createAvatar();}};d.prototype._setCardHeader=function(e){var s=this._oCardManifest.get("sap.card/header");var o=jQuery.extend(true,{},s);delete o.type;var h=new e(o);this.setAggregation("_header",h);this.setBusy(false);};d.prototype._setContent=function(){var s=this._oCardManifest.get("sap.card/type");if(!s){L.error("Card type property is mandatory!");return;}if(s==="Custom"){var o=new c({async:true,manifest:this._oCardManifest.getJson(),settings:{}});this.setContent(o);}else{switch(s.toLowerCase()){case"list":sap.ui.require(["sap/f/cards/content/List"],this._setCardContent.bind(this));break;case"table":sap.ui.require(["sap/f/cards/content/Table"],this._setCardContent.bind(this));break;case"analytical":sap.ui.getCore().loadLibrary("sap.viz",{async:true}).then(function(){sap.ui.require(["sap/f/cards/content/Analytical"],this._setCardContent.bind(this));}.bind(this)).catch(function(){L.error("Analytical type card is not available with this distribution");});break;}}};d.prototype._setCardContent=function(e){var s=this._oCardManifest.get("sap.card/content");var o=jQuery.extend(true,{},s);var f=new e(o);this.setContent(f);this.setBusy(false);};d.prototype._createTitle=function(){if(!this._oTitle){this._oTitle=new T({id:this.getId()+"-title",maxLines:3,text:this._oCardManifest.get("sap.card/title")}).addStyleClass("sapFCardTitle");}return this;};d.prototype._createSubTitle=function(){if(!this._oSubTitle){this._oSubTitle=new T({id:this.getId()+"-subtitle",maxLines:2,text:this._oCardManifest.get("sap.card/subtitle")}).addStyleClass("sapFCardSubtitle");}return this;};d.prototype._createAvatar=function(){if(!this._oAvatar){this._oAvatar=new A({id:this.getId()+"-avatar"}).addStyleClass("sapFCardIcon");var s=this._oCardManifest.get("sap.card/icon/displayShape"),e=this._oCardManifest.get("sap.card/icon/src"),f=this._oCardManifest.get("sap.card/icon/initials");if(e){this._oAvatar.setSrc(e);}else if(f){this._oAvatar.setInitials(f);}if(s){this._oAvatar.setDisplayShape(s);}}return this;};return d;});
