/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/model/json/JSONModel','sap/m/FlexBox','sap/viz/ui5/controls/VizFrame','sap/viz/ui5/controls/common/feeds/FeedItem','sap/viz/ui5/data/FlattenedDataset','sap/viz/ui5/data/DimensionDefinition','sap/viz/ui5/data/MeasureDefinition','sap/f/cards/Data'],function(C,J,F,V,a,b,D,M,c){"use strict";var A=C.extend("sap.f.cards.content.Analytical",{metadata:{properties:{chart:{type:"object"}},aggregations:{_content:{multiple:false,visibility:"hidden"}}},renderer:function(r,o){r.renderControl(o.getAggregation("_content"));}});A.prototype.init=function(){var m=new J();this.setModel(m);};A.prototype.exit=function(){if(this._oChart){this._oChart.destroy();this._oChart=null;}if(this.oFlattendedDataset){this.oFlattendedDataset.destroy();this.oFlattendedDataset=null;}};A.prototype.setChart=function(o){this.setProperty("chart",o,true);if(!o){return this;}var r=o.data.request;if(o.json&&!r){this._updateModel(o.json,o.path);}if(r){c.fetch(r).then(function(d){this._updateModel(d,o.data.path,o);}.bind(this)).catch(function(e){});}return this;};A.prototype._updateModel=function(d,p,o){var s=o.type;this.getModel().setData(d);var e=[];if(o.dimensions){var f=[];for(var i=0;i<o.dimensions.length;i++){var g=o.dimensions[i];var n=g.value.substring(1,g.value.length-1);e.push(n);var h={name:n,value:g.value};f.push(h);}}var m=[];if(o.measures){var j=[];for(var i=0;i<o.measures.length;i++){var k=o.measures[i];var n=k.value.substring(1,k.value.length-1);m.push(n);var l={name:n,value:k.value};j.push(l);}}this.oFlattendedDataset=new b({measures:j,dimensions:f,data:{path:o.data.path}});this._oChart=new V({uiConfig:{applicationSet:'fiori'},vizType:s,dataset:this.oFlattendedDataset,legendVisible:o.legend,feeds:[new a({uid:o.measureUid,type:'Measure',values:m}),new a({uid:o.dimensionUid,type:'Dimension',values:e})]});this._oChart.setVizProperties(o.vizProperties);this.setAggregation("_content",this._oChart);};return A;});
